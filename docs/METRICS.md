# Метрики SmoothTask

## Глобальные метрики

### CPU
- Процент использования CPU (user%, system%, idle%, iowait%)
- Источник: `/proc/stat`

### Memory
- Используемая и доступная память
- Используемый swap
- Источник: `/proc/meminfo`

### Load Average
- Средняя нагрузка системы
- Источник: `/proc/loadavg`

### PSI (Pressure Stall Information)
- `cpu_some_avg10`, `cpu_some_avg60` — давление на CPU
- `io_some_avg10` — давление на IO
- `mem_some_avg10`, `mem_full_avg10` — давление на память
- Источник: `/proc/pressure/{cpu,io,memory}`

### GPU
- Метрики использования, памяти, температуры, энергопотребления и тактовых частот для всех GPU устройств
- См. раздел "GPU метрики" ниже для подробностей

### User Activity
- `user_active` (bool) — активен ли пользователь
- `time_since_last_input` — время с последнего ввода
- Источник: события evdev

## Per-process метрики

### Легкие метрики (для всех процессов)
- CPU usage (дельты за окно)
- Состояние процесса (R/S/D/Z/T)
- Приоритеты (nice, latency_nice, ionice)
- RSS
- Источник: `/proc/[pid]/stat`, `/proc/[pid]/sched`, `/proc/[pid]/io`

### Тяжелые метрики (только для кандидатов)
- Детальная информация о памяти (VmRSS, VmSwap)
- Контекстные переключения
- IO статистика (read_bytes, write_bytes)
- Переменные окружения
- Источники: `/proc/[pid]/status`, `/proc/[pid]/io`, `/proc/[pid]/environ`

## GPU метрики

### Общая информация
- Количество GPU устройств в системе
- Информация о каждом GPU устройстве (имя, путь, вендор ID, устройство ID, драйвер)
- Источники: `/sys/class/drm`, `/sys/class/drm/*/device`

### Метрики использования
- Процент использования GPU ядра (0.0 до 1.0)
- Процент использования GPU памяти (0.0 до 1.0)
- Процент использования GPU энкодера (опционально, 0.0 до 1.0)
- Процент использования GPU декодера (опционально, 0.0 до 1.0)
- Источники: `/sys/class/drm/*/device/gpu_busy_percent`, драйвер-специфичные интерфейсы

### Метрики памяти
- Общий объем GPU памяти в байтах
- Используемая GPU память в байтах
- Свободная GPU память в байтах
- Источники: `/sys/class/drm/*/device/mem_total_bytes`, `/sys/class/drm/*/device/mem_used_bytes`

### Температурные метрики
- Текущая температура GPU в Цельсиях
- Температура горячей точки GPU в Цельсиях (опционально)
- Температура памяти GPU в Цельсиях (опционально)
- Источники: `/sys/class/drm/*/device/hwmon/*/temp*_input`

### Метрики энергопотребления
- Текущее энергопотребление GPU в ваттах
- Лимит энергопотребления GPU в ваттах (опционально)
- Максимальное энергопотребление GPU в ваттах (опционально)
- Источники: `/sys/class/powercap/*/energy_uj`, `/sys/class/drm/*/device/hwmon/*/power*_input`

### Метрики тактовых частот
- Текущая частота GPU ядра в МГц
- Текущая частота GPU памяти в МГц (опционально)
- Текущая частота GPU шейдеров в МГц (опционально)
- Источники: `/sys/class/drm/*/device/gt_cur_freq_mhz`, драйвер-специфичные интерфейсы

## Метрики отзывчивости

### Scheduling Latency
- P95 и P99 латентности планировщика
- Измеряется через probe-thread (mini-cyclictest)

### Аудио XRUN
- Количество XRUN событий в аудио-стеке
- Источник: PipeWire/PulseAudio

### UI Latency (опционально)
- P95 латентности event loop GUI
- Frame jank ratio

### Интегральный score
- `bad_responsiveness` — флаг плохой отзывчивости
- `responsiveness_score` — нормированная комбинация метрик

## Частота сбора

- Глобальные метрики: 500–1000 мс
- Per-process (легкие): 1–2 Гц для всех процессов
- Per-process (тяжелые): 500–1000 мс, только для топ-N кандидатов
- Ввод пользователя: в реальном времени через evdev
- Окна/фокус: синхронизировано с циклом метрик
- Аудио: синхронизировано с циклом метрик

