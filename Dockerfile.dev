# SmoothTask Development Dockerfile
# This Dockerfile creates a development environment with all dependencies
# for building and testing SmoothTask in a container.

FROM rust:1.75-slim

# Install development dependencies
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    build-essential \
    cmake \
    pkg-config \
    git \
    curl \
    wget \
    libssl-dev \
    libsystemd-dev \
    libdbus-1-dev \
    libudev-dev \
    libwayland-dev \
    libxkbcommon-dev \
    libpipewire-0.3-dev \
    libpulse-dev \
    libasound2-dev \
    libevdev-dev \
    libinput-dev \
    libseat-dev \
    libclang-dev \
    clang \
    python3 \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# Set up working directory
WORKDIR /app

# Copy source code
COPY . .

# Set up Python virtual environment for trainer
RUN python3 -m venv /app/.venv && \
    /app/.venv/bin/pip install --upgrade pip && \
    /app/.venv/bin/pip install -e smoothtask-trainer

# Build SmoothTask
RUN cargo build --release

# Set up environment variables
ENV PATH="/app/target/release:/app/.venv/bin:$PATH"
ENV RUST_LOG=info
ENV SMOOTHTASK_CONFIG=/app/configs/smoothtask.example.yml

# Expose API port
EXPOSE 8080

# Default command - run the daemon
CMD ["smoothtaskd", "--config", "/app/configs/smoothtask.example.yml"]