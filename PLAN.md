# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-006: Классы приоритетов и маппинг на nice/ionice/cgroup
  - Тип: Rust / core / policy
  - Критерии готовности:
    - Определение enum классов приоритетов (CRIT_INTERACTIVE, INTERACTIVE, NORMAL, BACKGROUND, IDLE);
    - Структуры для маппинга на nice, ionice (class/level), cpu.weight;
    - Unit-тесты на корректность маппинга;
    - API готово для использования в policy engine и actuator.
  - Примечания: реализованы все классы приоритетов с маппингом согласно POLICY.md, добавлены 10 unit-тестов, поддержка serde для сериализации.

- [x] ST-001: Глобальные метрики /proc + PSI
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Парсинг `/proc/stat`, `/proc/meminfo`, `/proc/loadavg`, `/proc/pressure/{cpu,io,memory}`;
    - Unit-тесты на фиктивных данных (без зависимости от реального /proc);
    - API готово для интеграции в сборщик снапшотов.
  - Примечания: реализованы парсеры и фиктивный /proc в тестах.

- [x] ST-002: Экспорт снапшотов в SQLite и чтение в трейнере
  - Тип: Rust + Python / logging + trainer
  - Критерии готовности:
    - Запись снапшотов через `logging::snapshots` в SQLite;
    - Утилиты чтения в `smoothtask-trainer`;
    - Базовые тесты на запись/чтение.
  - Примечания: реализованы тесты для записи (Rust) и чтения (Python), исправлена ошибка с количеством колонок в INSERT-запросе.

- [~] ST-004: Каркас WindowIntrospector и выбор фокусного окна
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Нормализованные структуры `WindowInfo`/`WindowState`;
    - Каркас интерфейса `WindowIntrospector` с базовым бекендом-заглушкой;
    - Юнит-тесты на выбор активного окна и корректность confidence.
  - Примечания: добавлены структуры и статический бекенд; выбор активного окна теперь учитывает `pid_confidence`; ещё нужен реальный X11/Wayland адаптер.

## 2. Бэклог

- [ ] ST-005-2: Реальный PipeWire/PulseAudio адаптер для AudioIntrospector
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Подключение к PipeWire или PulseAudio;
    - Подписка на события XRUN;
    - Получение списка активных клиентов с PID;
    - Интеграционные тесты с реальным аудио-стеком (опционально).

## 3. Готово (Done)

- [x] ST-000: Валидация конфигурации при загрузке
  - Примечания: покрыто юнит-тестом загрузки `Config::load`.
- [x] ST-003: Сбор пользовательского ввода (evdev) для user_active/idle
  - Примечания: добавлен `InputActivityTracker` с юнит-тестами, считает `user_active` и `time_since_last_input_ms` без зависимости от реального `/dev/input`.
- [x] ST-006: Классы приоритетов и маппинг на nice/ionice/cgroup
  - Примечания: реализованы все классы приоритетов с маппингом согласно POLICY.md, добавлены 10 unit-тестов, поддержка serde для сериализации.
- [x] ST-005-1: Каркас аудио метрик (структуры, трейт, статический бекенд)
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Структуры `AudioMetrics`, `AudioClientInfo`, `XrunInfo`;
    - Трейт `AudioIntrospector` с методами `audio_metrics()` и `clients()`;
    - `StaticAudioIntrospector` для тестов;
    - Unit-тесты на все компоненты (8 тестов).
  - Примечания: реализованы нормализованные структуры данных для XRUN событий и аудио-клиентов, трейт для абстракции бекендов, статический бекенд для тестов. Добавлены 8 unit-тестов, покрывающих основные сценарии. API готово для интеграции реальных PipeWire/PulseAudio адаптеров.

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.
