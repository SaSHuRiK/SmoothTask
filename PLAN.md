# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-006: Классы приоритетов и маппинг на nice/ionice/cgroup
  - Тип: Rust / core / policy
  - Критерии готовности:
    - Определение enum классов приоритетов (CRIT_INTERACTIVE, INTERACTIVE, NORMAL, BACKGROUND, IDLE);
    - Структуры для маппинга на nice, ionice (class/level), cpu.weight;
    - Unit-тесты на корректность маппинга;
    - API готово для использования в policy engine и actuator.
  - Примечания: реализованы все классы приоритетов с маппингом согласно POLICY.md, добавлены 10 unit-тестов, поддержка serde для сериализации.

- [x] ST-001: Глобальные метрики /proc + PSI
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Парсинг `/proc/stat`, `/proc/meminfo`, `/proc/loadavg`, `/proc/pressure/{cpu,io,memory}`;
    - Unit-тесты на фиктивных данных (без зависимости от реального /proc);
    - API готово для интеграции в сборщик снапшотов.
  - Примечания: реализованы парсеры и фиктивный /proc в тестах.

- [x] ST-002: Экспорт снапшотов в SQLite и чтение в трейнере
  - Тип: Rust + Python / logging + trainer
  - Критерии готовности:
    - Запись снапшотов через `logging::snapshots` в SQLite;
    - Утилиты чтения в `smoothtask-trainer`;
    - Базовые тесты на запись/чтение.
  - Примечания: реализованы тесты для записи (Rust) и чтения (Python), исправлена ошибка с количеством колонок в INSERT-запросе.


## 2. Бэклог

- [ ] ST-005-2: Реальный PipeWire/PulseAudio адаптер для AudioIntrospector
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Подключение к PipeWire или PulseAudio;
    - Подписка на события XRUN;
    - Получение списка активных клиентов с PID;
    - Интеграционные тесты с реальным аудио-стеком (опционально).

## 3. Готово (Done)

- [x] ST-000: Валидация конфигурации при загрузке
  - Примечания: покрыто юнит-тестом загрузки `Config::load`.
- [x] ST-003: Сбор пользовательского ввода (evdev) для user_active/idle
  - Примечания: добавлен `InputActivityTracker` с юнит-тестами, считает `user_active` и `time_since_last_input_ms` без зависимости от реального `/dev/input`.
- [x] ST-006: Классы приоритетов и маппинг на nice/ionice/cgroup
  - Примечания: реализованы все классы приоритетов с маппингом согласно POLICY.md, добавлены 10 unit-тестов, поддержка serde для сериализации.
- [x] ST-005-1: Каркас аудио метрик (структуры, трейт, статический бекенд)
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Структуры `AudioMetrics`, `AudioClientInfo`, `XrunInfo`;
    - Трейт `AudioIntrospector` с методами `audio_metrics()` и `clients()`;
    - `StaticAudioIntrospector` для тестов;
    - Unit-тесты на все компоненты (8 тестов).
  - Примечания: реализованы нормализованные структуры данных для XRUN событий и аудио-клиентов, трейт для абстракции бекендов, статический бекенд для тестов. Добавлены 8 unit-тестов, покрывающих основные сценарии. API готово для интеграции реальных PipeWire/PulseAudio адаптеров.
- [x] ST-004: Каркас WindowIntrospector и выбор фокусного окна
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Нормализованные структуры `WindowInfo`/`WindowState`;
    - Каркас интерфейса `WindowIntrospector` с базовым бекендом-заглушкой;
    - Юнит-тесты на выбор активного окна и корректность confidence.
  - Примечания: реализованы структуры и статический бекенд; выбор активного окна учитывает `pid_confidence`; добавлены функции `get_window_info_by_pid()` и `build_pid_to_window_map()`; покрыто 12 unit-тестами. Реальный X11/Wayland адаптер - отдельная задача из бэклога.
- [x] ST-007: Process Grouper для группировки процессов в AppGroup
  - Тип: Rust / core / classify
  - Критерии готовности:
    - Модуль `classify::grouper` с функцией `group_processes()`;
    - Группировка по cgroup_path (с нормализацией);
    - Группировка по дереву процессов (root и потомки);
    - Определение root_pid для каждой группы;
    - Агрегация метрик группы (CPU, IO, память, GUI, теги);
    - Unit-тесты на все сценарии группировки (8 тестов).
  - Примечания: реализован алгоритм группировки процессов в AppGroup с поддержкой группировки по cgroup и дереву процессов. Добавлены 8 unit-тестов, покрывающих пустой список, одиночный процесс, дерево процессов, группировку по cgroup, множественные группы, нормализацию cgroup, агрегацию метрик и независимые деревья.
- [x] ST-008-1: Структуры данных для паттернов и загрузка из YAML
  - Тип: Rust / core / classify
  - Критерии готовности:
    - Структуры для представления паттернов приложений (AppPattern, PatternCategory);
    - Загрузка паттернов из YAML файлов в директории patterns;
    - Поддержка сопоставления по exe_patterns, desktop_patterns, cgroup_patterns;
    - Unit-тесты на загрузку и парсинг паттернов.
  - Примечания: реализованы структуры PatternDatabase, AppPattern, PatternFile с загрузкой из YAML. Поддержка простых wildcard паттернов (*, ?). Добавлены 7 unit-тестов на загрузку и сопоставление паттернов.
- [x] ST-008-2: Классификатор процессов по паттернам
  - Тип: Rust / core / classify
  - Критерии готовности:
    - Функция классификации процессов и AppGroup по паттернам;
    - Заполнение process_type и tags в ProcessRecord;
    - Агрегация тегов для AppGroupRecord;
    - Unit-тесты на классификацию различных процессов.
  - Примечания: реализованы функции classify_process(), classify_app_group() и classify_all() для классификации процессов и групп по паттернам. Заполняются process_type и tags. Добавлены 4 unit-теста на классификацию (всего 11 тестов в модуле).

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.
