# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-532: Оптимизировать производительность основного цикла сбора метрик
  - Тип: Rust / core / metrics / performance
  - Критерии готовности:
    - [x] Проанализировать текущие узкие места в основном цикле
    - [x] Оптимизировать параллельный сбор метрик
    - [x] Добавить кэширование для часто используемых данных
    - [x] Провести бенчмаркинг до и после оптимизации
  - Примечания: Улучшение общей производительности демона через параллельную обработку и улучшенное кэширование
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Добавлены параллельный сбор метрик и улучшенное кэширование
  - Новые возможности:
    - `collect_system_metrics_parallel()` - параллельный сбор системных метрик
    - `collect_system_metrics_cached_parallel()` - кэшированный параллельный сбор метрик
    - Вспомогательные функции для параллельной обработки различных типов метрик
    - Комплексные тесты для новой функциональности

- [x] ST-534: Улучшить обработку ошибок в eBPF модуле
  - Тип: Rust / core / metrics / eBPF / quality
  - Критерии готовности:
    - [x] Добавить более детализированные сообщения об ошибках
    - [x] Улучшить graceful degradation при отсутствии eBPF поддержки
    - [x] Добавить валидацию конфигурации
    - [x] Улучшить логирование
  - Примечания: Повышение надежности и удобства отладки eBPF функциональности
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Улучшена обработка ошибок, добавлены новые поля конфигурации, улучшено логирование
    - smoothtask-core/src/ebpf_programs/network_monitor.c: Добавлена новая eBPF программа для мониторинга сети
  - Новые возможности:
    - `enable_network_monitoring` - включение мониторинга сетевой активности
    - `max_init_attempts` - максимальное количество попыток инициализации
    - `operation_timeout_ms` - таймаут для операций eBPF
    - `network_packets` и `network_bytes` - метрики сетевой активности
    - `validate_config()` - валидация конфигурации
    - `get_last_error()` - получение последней ошибки
    - `is_initialized()` - проверка состояния инициализации
    - `reset()` - сброс состояния коллектора

- [x] ST-533: Добавить поддержку мониторинга сетевых соединений через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - [x] Исследовать возможности мониторинга сетевых соединений через eBPF
    - [x] Реализовать eBPF программу для отслеживания сетевой активности
    - [x] Добавить поддержку в EbpfMetricsCollector
    - [x] Интегрировать с основной системой метрик
    - [x] Добавить тесты для проверки функциональности
  - Примечания: Расширенный мониторинг сетевой активности для улучшения анализа производительности
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлена поддержка мониторинга сетевой активности
    - smoothtask-core/src/ebpf_programs/network_monitor.c: Реализована eBPF программа для мониторинга сети
    - smoothtask-core/tests/ebpf_integration_test.rs: Добавлены тесты для новой функциональности
  - Новые возможности:
    - Мониторинг сетевых пакетов и байт
    - Детализированная статистика по IP адресам
    - Интеграция с основной системой метрик

## 2. Бэклог

- [ ] ST-530: Улучшить документацию и тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / documentation
  - Критерии готовности:
    - ✅ Обновить EBPF_SETUP.md с последними изменениями
    - ✅ Добавить примеры использования eBPF в основной документации
    - ✅ Улучшить тестовое покрытие eBPF функциональности
    - ✅ Документировать ограничения и требования к системе
    - ✅ Добавить примеры интеграции с основной системой метрик
  - Примечания: Улучшение документации и тестирования для eBPF функциональности
  - Приоритет: Средний

- [ ] ST-513: Добавить поддержку мониторинга системных вызовов через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Исследовать возможности мониторинга системных вызовов через eBPF
    - ✅ Реализовать eBPF программу для отслеживания системных вызовов
    - ✅ Добавить поддержку в EbpfMetricsCollector
    - ✅ Интегрировать с основной системой метрик
    - ✅ Добавить тесты для проверки функциональности
  - Примечания: Расширенный мониторинг системных вызовов для улучшения анализа производительности
  - Приоритет: Средний

- [ ] ST-514: Оптимизировать производительность eBPF программ
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Проанализировать текущую производительность eBPF программ
    - ✅ Оптимизировать использование карт и структур данных
    - ✅ Уменьшить накладные расходы на сбор метрик
    - ✅ Провести бенчмаркинг до и после оптимизации
  - Примечания: Улучшение производительности eBPF программ для снижения нагрузки на систему
  - Приоритет: Средний

- [ ] ST-515: Провести тестирование eBPF на реальных системах
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Провести тестирование на различных конфигурациях ядра
    - ✅ Проверить совместимость с различными дистрибутивами Linux
    - ✅ Собрать метрики производительности и стабильности
    - ✅ Документировать результаты и ограничения
  - Примечания: Тестирование eBPF функциональности на реальных системах для обеспечения стабильности
  - Приоритет: Низкий

- [ ] ST-485: Исследовать и добавить поддержку eBPF-метрик
  - Тип: Rust / core / metrics / исследование
  - Критерии готовности:
    - ✅ Исследовать возможности eBPF для сбора метрик
    - ✅ Оценить производительность и совместимость
    - ✅ Добавить базовую поддержку, если применимо
  - Примечания: Потенциальное улучшение для будущих версий
  - Приоритет: Низкий

- [ ] ST-490: Реализовать расширенную систему уведомлений
  - Тип: Rust / core / notifications
  - Критерии готовности:
    - ✅ Исследовать возможности уведомлений через D-Bus
    - ✅ Добавить поддержку уведомлений о изменениях приоритетов
    - ✅ Интегрировать с системой логирования
  - Примечания: Улучшение пользовательского опыта
  - Приоритет: Низкий

## 3. Недавно сделано (Recently Done)

- [x] ST-533: Добавить поддержку мониторинга сетевых соединений через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Успешная реализация мониторинга сетевой активности через eBPF с поддержкой детализированной статистики по IP адресам и интеграцией с основной системой метрик.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлена поддержка мониторинга сетевой активности
    - smoothtask-core/src/ebpf_programs/network_monitor.c: Реализована eBPF программа для мониторинга сети
    - smoothtask-core/tests/ebpf_integration_test.rs: Добавлены тесты для новой функциональности
  - Новые возможности:
    - Мониторинг сетевых пакетов и байт
    - Детализированная статистика по IP адресам
    - Интеграция с основной системой метрик

- [x] ST-534: Улучшить обработку ошибок в eBPF модуле
  - Тип: Rust / core / metrics / eBPF / quality
  - Примечания: Значительное улучшение надежности и удобства отладки eBPF функциональности. Добавлена поддержка мониторинга сетевой активности, улучшена обработка ошибок и добавлены новые возможности конфигурации.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Улучшена обработка ошибок, добавлены новые поля конфигурации, улучшено логирование
    - smoothtask-core/src/ebpf_programs/network_monitor.c: Добавлена новая eBPF программа для мониторинга сети
    - smoothtask-core/tests/ebpf_integration_test.rs: Обновлены тесты для новой функциональности
    - smoothtask-core/tests/ebpf_mock_test.rs: Обновлены тесты для новой функциональности
  - Новые возможности:
    - Поддержка мониторинга сетевой активности через eBPF
    - Улучшенная обработка ошибок с graceful degradation
    - Валидация конфигурации
    - Новые метрики: network_packets, network_bytes
    - Новые методы: validate_config(), get_last_error(), is_initialized(), reset()

- [x] ST-532: Оптимизировать производительность основного цикла сбора метрик
  - Тип: Rust / core / metrics / performance
  - Примечания: Значительное улучшение производительности демона через параллельную обработку и улучшенное кэширование. Реализованы новые функции для параллельного сбора системных метрик с использованием rayon.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Добавлены параллельный сбор метрик и улучшенное кэширование
  - Новые возможности:
    - `collect_system_metrics_parallel()` - параллельный сбор системных метрик
    - `collect_system_metrics_cached_parallel()` - кэшированный параллельный сбор метрик
    - Вспомогательные функции для параллельной обработки различных типов метрик
    - Комплексные тесты для новой функциональности

- [x] ST-531: Провести интеграционное тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / testing
  - Примечания: Исправлены ошибки компиляции в тестах и обновлены для работы с новой структурой EbpfMetrics. Все тесты теперь проходят успешно.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/tests/ebpf_mock_test.rs: Исправлены ошибки компиляции и обновлены тесты для новой структуры EbpfMetrics
    - smoothtask-core/tests/ebpf_integration_test.rs: Адаптированы тесты для работы без реальной eBPF поддержки

- [x] ST-530: Улучшить документацию и тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / documentation
  - Примечания: Значительно улучшена документация eBPF с добавлением примеров использования, устранения неполадок, тестирования и будущих улучшений. Добавлены comprehensive тесты для eBPF функциональности.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - docs/EBPF_SETUP.md: Полностью переработана документация с добавлением разделов по архитектуре, расширенной настройке, тестированию и примерам использования
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены 10 новых тестов для улучшения покрытия eBPF функциональности

См. архив: docs/history/PLAN_DONE_archive.md

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.