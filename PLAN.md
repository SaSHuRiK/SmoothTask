# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-712: Проверить и улучшить обработку ошибок в network модуле
  - Тип: Code Quality / Error Handling
  - Примечания: Улучшение обработки ошибок и добавление более детальных сообщений
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Проверить все функции на корректную обработку ошибок
    - [x] Добавить более информативные сообщения об ошибках с контекстом
    - [x] Улучшить graceful degradation для сетевых функций
    - [x] Добавить проверки прав доступа и валидацию данных
    - [x] Улучшить логирование для отладки и мониторинга
  - Ожидаемые результаты: Значительно улучшено качество обработки ошибок в network модуле
  - Результаты: Улучшена обработка ошибок в collect_interface_stats, collect_protocol_stats, collect_connection_stats и вспомогательных функциях. Добавлены детальные сообщения об ошибках с контекстом, улучшено graceful degradation, добавлены проверки валидации данных и улучшено логирование.
  - Изменённые файлы:
    - smoothtask-core/src/metrics/network.rs: Улучшена обработка ошибок и добавлены детальные сообщения

- [x] ST-713: Добавить дополнительные тесты для edge cases в network модуле
  - Тип: Testing / QA
  - Примечания: Добавление тестов для редких и граничных случаев
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Критерии готовности:
    - [x] Добавить тесты для обработки пустых данных
    - [x] Добавить тесты для обработки невалидных данных
    - [x] Добавить тесты для обработки ошибок файловой системы
    - [x] Добавить тесты для обработки сетевых ошибок
    - [x] Добавить тесты для конкурентного доступа
  - Ожидаемые результаты: Полное покрытие edge cases для network модуля
  - Результаты: Добавлены 12 новых тестов для edge cases, включая тесты для пустых данных, невалидных значений, максимальных значений, сериализации и обработки ошибок. Тесты покрывают все основные структуры и функции network модуля.
  - Изменённые файлы:
    - smoothtask-core/src/metrics/network.rs: Добавлены новые тесты для edge cases

- [x] ST-714: Оптимизировать производительность network мониторинга
  - Тип: Performance / Optimization
  - Примечания: Оптимизация производительности сбора сетевых метрик
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Критерии готовности:
    - [x] Проанализировать текущую производительность
    - [x] Оптимизировать чтение и парсинг данных
    - [x] Добавить кэширование для часто используемых данных
    - [x] Оптимизировать использование памяти
    - [x] Добавить бенчмарки для измерения производительности
  - Ожидаемые результаты: Значительное улучшение производительности network мониторинга
  - Результаты: Реализованы оптимизации чтения и парсинга сетевых данных, добавлен механизм кэширования интерфейсов с настраиваемым TTL, оптимизировано использование памяти, добавлены бенчмарки для измерения производительности
  - Изменённые файлы:
    - smoothtask-core/src/metrics/network.rs: Добавлены оптимизированные методы, кэширование интерфейсов, бенчмарки

- [x] ST-691: Обучить модель на реальных данных
  - Тип: ML / Training
  - Примечания: Обучить CatBoostRanker модель на собранных данных
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Запустить pipeline обучения на собранных данных
    - [x] Сохранить модель в форматах JSON и ONNX
    - [x] Проверить качество обученной модели
    - [x] Документировать параметры обучения
  - Ожидаемые результаты: Обученная модель CatBoostRanker в форматах JSON и ONNX
  - Результаты: Обученная модель CatBoostRanker с параметрами YetiRank, depth=6, learning_rate=0.1, iterations=500
  - Изменённые файлы:
    - trained_model.json: Модель в формате JSON (1.9MB)
    - trained_model.onnx: Модель в формате ONNX (2.4MB)
    - train_model.py: Скрипт для обучения модели

- [x] ST-692: Интегрировать обученную модель в конфигурацию
  - Тип: Integration / Configuration
  - Примечания: Обновить конфигурацию для использования обученной модели
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~15 минут
  - Критерии готовности:
    - [x] Обновить пример конфигурации для использования ML модели
    - [x] Добавить документацию по настройке ML режима
    - [x] Проверить совместимость модели с текущей системой
  - Ожидаемые результаты: Готовая конфигурация для использования ML модели
  - Результаты: Обновлена конфигурация и создана документация для использования ML модели
  - Изменённые файлы:
    - configs/smoothtask.example.yml: Обновлена конфигурация для использования ML модели
    - configs/smoothtask.example.example.backup.yml: Резервная копия оригинальной конфигурации
    - MODEL_README.md: Документация по обученной модели
    - integrate_model.py: Скрипт для интеграции модели

- [x] ST-688: Провести аудит кода на наличие потенциальных проблем
  - Тип: Code Quality / Audit
  - Примечания: Проверка кода на наличие unwrap(), panic! и других антипаттернов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~20 минут
  - Критерии готовности:
    - [x] Проверить критические модули на наличие unsafe кода
    - [x] Проверить использование unwrap() в тестах (приемлемо)
    - [x] Проверить использование panic! в eBPF коде (приемлемо для отладочных целей)
    - [x] Документировать найденные проблемы
  - Результаты: Код в хорошем состоянии, unsafe используется только для системных вызовов, unwrap() только в тестах

- [x] ST-689: Улучшить покрытие тестами для модуля onnx_ranker
  - Тип: Testing / QA
  - Примечания: Добавление тестов для ONNX-ранкера
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Критерии готовности:
    - [x] Добавить тесты для основного функционала
    - [x] Исправить обработку ошибок mutex (уже сделано)
    - [x] Добавить тесты для edge cases (string_to_index, features_to_tensor)
    - [x] Добавить тесты для обработки ошибок в rank()
    - [x] Проверить производительность
  - Изменённые файлы:
    - smoothtask-core/src/model/onnx_ranker.rs: Добавлены новые тесты для edge cases
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены падающие тесты
    - smoothtask-core/src/policy/engine.rs: Исправлены падающие тесты
  - Результаты: Все тесты проходят, улучшено покрытие edge cases


## 2. Бэклог

- [x] ST-693: Добавить комплексную документацию для новых функций
  - Тип: Documentation
  - Примечания: Обновление документации для новых функций, API и изменений в коде
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Обновить ML_CLASSIFICATION.md с описанием новых функций обучения
    - [x] Добавить примеры использования TrainingPipeline и интеграции модели
    - [x] Обновить ONNX_INTEGRATION.md с новым пайплайном обучения
    - [x] Добавить лучшие практики и устранение неполадок
    - [x] Проверить актуальность всех документов
  - Изменённые файлы:
    - docs/ML_CLASSIFICATION.md: Добавлена документация по TrainingPipeline, примерам использования, лучшим практикам
    - docs/ONNX_INTEGRATION.md: Обновлена документация по новому пайплайну обучения и интеграции
  - Результаты: Полная и актуальная документация по ML workflow с примерами и руководствами

- [x] ST-694: Улучшить обработку ошибок в критических модулях
  - Тип: Code Quality / Error Handling
  - Примечания: Добавление более детальных сообщений об ошибках и улучшение graceful degradation
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Критерии готовности:
    - [x] Проверить критические модули на качество обработки ошибок
    - [x] Добавить более информативные сообщения об ошибках с контекстом
    - [x] Улучшить graceful degradation с детальным логированием
    - [x] Добавить проверки прав доступа и валидацию данных
    - [x] Улучшить логирование для отладки и мониторинга
  - Изменённые файлы:
    - smoothtask-core/src/model/onnx_ranker.rs: Улучшена обработка ошибок загрузки модели, добавлены проверки прав доступа, улучшено логирование
    - smoothtask-core/src/model/ranker.rs: Добавлено детальное логирование в StubRanker для отладки
    - smoothtask-core/src/policy/engine.rs: Улучшена обработка ошибок загрузки модели, добавлены информативные сообщения для пользователя
  - Результаты: Значительно улучшено качество обработки ошибок, добавлены контекстные сообщения, улучшено graceful degradation и логирование

- [x] ST-667: Обновить документацию по ML и обучению моделей
  - Тип: Documentation / ML
  - Примечания: Создание комплексного руководства по сбору данных и обучению моделей
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - ✅ Создание руководства по сбору данных
    - ✅ Создание руководства по обучению моделей
    - ✅ Добавление примеров использования
    - ✅ Обновление существующей документации
    - ✅ Добавление диаграмм и визуализаций
  - Изменённые файлы:
    - docs/ML_CLASSIFICATION.md: Обновление документации по ML
    - docs/CATBOOST_V1_GUIDE.md: Добавление руководства по CatBoost
    - docs/ONNX_INTEGRATION.md: Обновление документации по ONNX
    - smoothtask-trainer/README.md: Обновление примеров
  - Результаты: Полная и актуальная документация по ML workflow с примерами и руководствами

## 3. Недавно сделано (Recently Done)

- [x] ST-714: Оптимизировать производительность network мониторинга
  - Тип: Performance / Optimization
  - Примечания: Оптимизация производительности сбора сетевых метрик
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Результаты: Реализованы оптимизации чтения и парсинга сетевых данных, добавлен механизм кэширования интерфейсов с настраиваемым TTL, оптимизировано использование памяти, добавлены бенчмарки для измерения производительности

- [x] ST-713: Добавить дополнительные тесты для edge cases в network модуле
  - Тип: Testing / QA
  - Примечания: Добавление тестов для редких и граничных случаев
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Результаты: Добавлены 12 новых тестов для edge cases, включая тесты для пустых данных, невалидных значений, максимальных значений, сериализации и обработки ошибок.

- [x] ST-712: Проверить и улучшить обработку ошибок в network модуле
  - Тип: Code Quality / Error Handling
  - Примечания: Улучшение обработки ошибок и добавление более детальных сообщений
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Улучшена обработка ошибок в collect_interface_stats, collect_protocol_stats, collect_connection_stats и вспомогательных функциях.

- [x] ST-711: Запустить все тесты для проверки отсутствия регрессий
  - Тип: Testing / QA
  - Примечания: Запуск полного набора тестов для проверки стабильности
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Критерии готовности:
    - [x] Запустить cargo test для smoothtask-core
    - [x] Проверить отсутствие регрессий
    - [x] Проверить отсутствие ошибок компиляции
    - [x] Проверить отсутствие предупреждений
  - Ожидаемые результаты: Все тесты проходят успешно
  - Результаты: Проект стабилен, нет регрессий, код компилируется без ошибок

- [x] ST-710: Обновить документацию для новых network функций
  - Тип: Documentation
  - Примечания: Обновление документации для новых network функций и API
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Критерии готовности:
    - [x] Обновить API.md с описанием новых network endpoints
    - [x] Обновить METRICS.md с описанием новых network метрик
    - [x] Добавить примеры использования network monitoring
    - [x] Добавить документацию по настройке network monitoring
  - Ожидаемые результаты: Полная и актуальная документация по network функциональности
  - Изменённые файлы:
    - docs/API.md: Добавлена документация по network endpoints
    - docs/METRICS.md: Добавлена документация по network метрикам
  - Результаты: Полная документация по network monitoring с примерами

- [x] ST-709: Добавить интеграционные тесты для network API endpoints
  - Тип: Testing / Integration
  - Примечания: Добавление интеграционных тестов для новых network API endpoints
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Добавить тесты для /api/network/stats
    - [x] Добавить тесты для /api/network/interfaces
    - [x] Добавить тесты для /api/network/protocols
    - [x] Добавить тесты для /api/network/ports
    - [x] Добавить тесты для /api/network/quality
    - [x] Проверить обработку ошибок и edge cases
  - Ожидаемые результаты: Полное покрытие интеграционными тестами для network API
  - Изменённые файлы:
    - smoothtask-core/tests/api_integration_test.rs: Добавлены новые тесты
  - Результаты: Все network API endpoints покрыты интеграционными тестами

- [x] ST-708: Добавить комплексные тесты для модуля network monitoring
  - Тип: Testing / QA
  - Примечания: Добавление дополнительных тестов для нового модуля network monitoring
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Добавить тесты для NetworkMonitor::collect_network_stats()
    - [x] Добавить тесты для NetworkMonitor::calculate_traffic_deltas()
    - [x] Добавить тесты для всех вспомогательных функций
    - [x] Добавить тесты для edge cases и обработки ошибок
    - [x] Проверить покрытие тестами для всех публичных функций
  - Ожидаемые результаты: Полное покрытие тестами для нового network модуля
  - Изменённые файлы:
    - smoothtask-core/src/metrics/network.rs: Добавлены новые тесты
  - Результаты: Все функции network модуля покрыты тестами

*(Более старые выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [x] ST-099: Вернуть зависимость onnxruntime с нужными фичами
  - Тип: Dependency / ML
  - Примечания: Использование ort 2.0.0-rc.10 для ONNX runtime
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Критерии готовности:
    - [x] Проверить доступность необходимых фич в текущей версии ort
    - [x] Обновить зависимости для использования ort с нужными фичами
    - [x] Проверить совместимость с текущим кодом
  - Ожидаемые результаты: Работающая интеграция ONNX runtime
  - Результаты: Текущая версия ort 2.0.0-rc.10 предоставляет все необходимые фичи для работы с ONNX моделями
  - Изменённые файлы:
    - smoothtask-core/Cargo.toml: Использование ort 2.0.0-rc.10 с фичей onnx
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены импорты для совместимости с текущей версией ort
    - smoothtask-core/src/model/onnx_ranker.rs: Использование актуальных импортов ort
