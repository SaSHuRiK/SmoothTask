# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [ ] ST-750: Реализовать расширенный мониторинг энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Добавление мониторинга энергопотребления на уровне процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (RAPL, eBPF, sysfs)
    - [ ] Реализовать сбор метрик энергопотребления
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Расширенный мониторинг энергопотребления для оптимизации политик

- [ ] ST-751: Улучшить интеграцию с Wayland для мониторинга окон
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение поддержки Wayland для интроспекции окон и приложений
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Исследовать Wayland протоколы для интроспекции
    - [ ] Реализовать поддержку основных композиторов (KWin, Mutter, Sway)
    - [ ] Интегрировать с существующей системой классификации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Полноценная поддержка Wayland для мониторинга окон

## 2. Бэклог

- [ ] ST-740: Реализовать расширенный мониторинг энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Добавление мониторинга энергопотребления на уровне процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (RAPL, eBPF, sysfs)
    - [ ] Реализовать сбор метрик энергопотребления
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Расширенный мониторинг энергопотребления для оптимизации политик

- [ ] ST-741: Улучшить интеграцию с Wayland для мониторинга окон
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение поддержки Wayland для интроспекции окон и приложений
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Исследовать Wayland протоколы для интроспекции
    - [ ] Реализовать поддержку основных композиторов (KWin, Mutter, Sway)
    - [ ] Интегрировать с существующей системой классификации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Полноценная поддержка Wayland для мониторинга окон

- [ ] ST-742: Оптимизировать использование памяти в системе логирования
  - Тип: Rust / core / logging / optimization
  - Примечания: Улучшение управления памятью в системе логирования и снапшотов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~45 минут
  - Критерии готовности:
    - [ ] Проанализировать текущее использование памяти
    - [ ] Реализовать ротацию и очистку старых логов
    - [ ] Добавить лимиты на размер логов
    - [ ] Добавить мониторинг использования памяти
  - Ожидаемые результаты: Более эффективное использование памяти в системе логирования

- [ ] ST-743: Добавить поддержку мониторинга дискового ввода-вывода на уровне процессов
  - Тип: Rust / core / metrics / io
  - Примечания: Расширенный мониторинг операций ввода-вывода для процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (/proc, eBPF, io_uring)
    - [ ] Реализовать сбор метрик дискового ввода-вывода
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более точный мониторинг дисковой активности

- [ ] ST-744: Улучшить систему автоматического обновления конфигурации
  - Тип: Rust / core / config / auto-update
  - Примечания: Автоматическое обновление конфигурации и паттернов без перезапуска
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Реализовать механизм наблюдения за файлами конфигурации
    - [ ] Добавить горячую перезагрузку паттернов и политик
    - [ ] Реализовать уведомления об изменениях конфигурации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более гибкая система управления конфигурацией

## 3. Недавно сделано (Recently Done)

- [x] ST-749: Улучшить обработку ошибок в системе логирования
  - Тип: Rust / core / logging
  - Примечания: Добавление более детальных сообщений об ошибках и улучшение обработки ошибок
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Результаты: Более информативные и полезные сообщения об ошибках в системе логирования
  - Изменённые файлы:
    - smoothtask-core/src/logging/log_storage.rs: Улучшенные сообщения об ошибках в TracingLogWriter
    - smoothtask-core/src/logging/rotation.rs: Добавлены детальные сообщения об ошибках с контекстом
    - smoothtask-core/src/logging/snapshots.rs: Улучшенные сообщения об ошибках в методах сериализации
  - Тесты: Добавлены новые тесты для проверки обработки ошибок

- [x] ST-749: Исправить предупреждения clippy в коде
  - Тип: Code Quality / Clippy
  - Примечания: Исправление предупреждений clippy о бесполезных сравнениях, избыточных шаблонах и назначениях полей
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Чистый код без предупреждений clippy в основных модулях
  - Изменённые файлы:
    - smoothtask-core/src/metrics/cache.rs: Исправлены бесполезные сравнения
    - smoothtask-core/src/metrics/ebpf.rs: Исправлены бесполезные сравнения и назначения полей
    - smoothtask-core/src/metrics/network.rs: Исправлены избыточные шаблоны и назначения полей
    - smoothtask-core/tests/caching_test.rs: Исправлены ненужные unwrap
    - smoothtask-core/tests/ebpf_integration_test.rs: Исправлены ненужные mut и assert_eq с булевыми литералами

- [x] ST-748: Улучшить документацию API для новых endpoint-ов
  - Тип: Documentation / API
  - Примечания: Обновление документации API.md с описанием новых endpoint-ов мониторинга
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~20 минут
  - Результаты: Полная и актуальная документация API с примерами использования
  - Изменённые файлы:
    - docs/API.md: Добавлена документация для /api/logging/monitoring и /api/cache/monitoring

- [x] ST-747: Провести аудит кода на наличие новых предупреждений clippy
  - Тип: Code Quality / Audit
  - Примечания: Проверка кода на наличие новых предупреждений clippy после последних изменений
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Результаты: Чистый код без критических предупреждений clippy
  - Изменённые файлы:
    - Различные файлы: Исправлены предупреждения clippy

- [x] ST-746: Исправить ложное срабатывание clippy для log_ebpf_error
  - Тип: Rust / core / metrics / code quality
  - Примечания: Добавление #[allow(dead_code)] для метода, который используется в условной компиляции
  - Приоритет: Низкий
  - Статус: COMPLETED
  - Время выполнения: ~5 минут
  - Результаты: Устранено ложное предупреждение clippy о неиспользуемом коде
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлен #[allow(dead_code)]

- [x] ST-745: Удалить неиспользуемые методы из network.rs
  - Тип: Rust / core / metrics / code quality
  - Примечания: Удаление неиспользуемых методов интерфейса из NetworkMonitor
  - Приоритет: Низкий
  - Статус: COMPLETED
  - Время выполнения: ~15 минут
  - Результаты: Улучшенное качество кода и устранение предупреждений компилятора
  - Изменённые файлы:
    - smoothtask-core/src/metrics/network.rs: Удалены неиспользуемые методы

- [x] ST-735: Провести аудит кода и устранить потенциальные проблемы
  - Тип: Code Quality / Audit
  - Примечания: Проверка кода на наличие потенциальных проблем и их устранение
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~20 минут
  - Результаты: Улучшенное качество кода и устранение потенциальных проблем
  - Изменённые файлы:
    - smoothtask-core/src/notifications/mod.rs: Исправлены проблемы с дублирующимися тестами, исправлены trait bounds для новых методов
    - smoothtask-core/src/metrics/cache.rs: Исправлены redundant field names

*(Более старые выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

## 4. Блокеры

- [x] ST-099: Вернуть зависимость onnxruntime с нужными фичами
  - Тип: Dependency / ML
  - Примечания: Использование ort 2.0.0-rc.10 для ONNX runtime
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Критерии готовности:
    - [x] Проверить доступность необходимых фич в текущей версии ort
    - [x] Обновить зависимости для использования ort с нужными фичами
    - [x] Проверить совместимость с текущим кодом
  - Ожидаемые результаты: Работающая интеграция ONNX runtime
  - Результаты: Текущая версия ort 2.0.0-rc.10 предоставляет все необходимые фичи для работы с ONNX моделями
  - Изменённые файлы:
    - smoothtask-core/Cargo.toml: Использование ort 2.0.0-rc.10 с фичей onnx
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены импорты для совместимости с текущей версией ort
    - smoothtask-core/src/model/onnx_ranker.rs: Использование актуальных импортов ort