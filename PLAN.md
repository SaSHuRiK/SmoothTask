# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-740: Реализовать расширенный мониторинг энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Добавление мониторинга энергопотребления на уровне процессов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [x] Исследовать доступные источники данных (RAPL, eBPF, sysfs)
    - [x] Реализовать сбор метрик энергопотребления
    - [x] Интегрировать с существующей системой метрик
    - [x] Добавить тесты для нового функционала
  - Ожидаемые результаты: Расширенный мониторинг энергопотребления для оптимизации политик
  - Результаты:
    - Создан новый модуль process_energy.rs с полным API для мониторинга энергопотребления процессов
    - Поддержка нескольких источников данных: /proc/[pid]/power/energy_uj, RAPL, eBPF
    - Реализована структура ProcessEnergyStats для хранения статистики энергопотребления
    - Добавлена поддержка EnergySource для отслеживания источника данных
    - Интегрировано с существующей системой метрик процессов
    - Добавлены comprehensive тесты для нового функционала
    - Реализована синхронная и асинхронная версии API
    - Добавлена поддержка batch обработки для нескольких процессов
    - Интегрировано с ProcessRecord для автоматического сбора метрик энергопотребления
    - Добавлена поддержка сериализации/десериализации для логирования и API
    - Реализована система кэширования и оптимизации производительности
    - Добавлена поддержка различных конфигураций мониторинга (RAPL, eBPF, ProcPower)
    - Полная интеграция с существующей инфраструктурой eBPF
    - Поддержка надежности данных и отслеживания источников
    - Добавлены тесты для всех вариантов использования и edge cases
    - Исправлены ошибки компиляции и интеграции
    - Улучшена обработка ошибок и совместимость с существующим кодом

- [x] ST-780: Исправить ошибки компиляции в тестовых случаях после добавления GPU полей
  - Тип: Rust / core / testing
  - Примечания: Обновление всех тестовых случаев после добавления GPU-метрик в ProcessRecord
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [x] Обновить тестовые случаи в metrics/process.rs
    - [x] Обновить тестовые случаи в policy/engine.rs
    - [x] Обновить тестовые случаи в classify/rules.rs
    - [x] Обновить тестовые случаи в logging/snapshots.rs
    - [x] Проверить успешную компиляцию всех тестов
  - Ожидаемые результаты: Все тесты компилируются без ошибок
  - Результаты:
    - Обновлены все тестовые случаи с использованием ProcessRecord::default() вместо ручной инициализации
    - Исправлены ошибки компиляции, связанные с отсутствующими GPU-полями
    - Успешная компиляция всех модулей без ошибок
    - Сохранена функциональность всех тестов

- [x] ST-741: Улучшить интеграцию с Wayland для мониторинга окон
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение поддержки Wayland для интроспекции окон и приложений
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [x] Исследовать Wayland протоколы для интроспекции
    - [x] Реализовать поддержку основных композиторов (KWin, Mutter, Sway, Hyprland, Wayfire)
    - [x] Интегрировать с существующей системой классификации
    - [x] Добавить тесты для нового функционала
  - Ожидаемые результаты: Полноценная поддержка Wayland для мониторинга окон
  - Результаты:
    - Реализован WaylandIntrospector с поддержкой wlr-foreign-toplevel-management протокола
    - Добавлена функция is_wayland_available() для обнаружения Wayland окружения
    - Реализована функция detect_wayland_compositor() для определения типа композитора
    - Поддержка основных композиторов: Mutter, KWin, Sway, Hyprland, Wayfire, Weston, River
    - Полная интеграция с WindowIntrospector trait для использования в системе классификации
    - Реализована graceful degradation при отсутствии Wayland или необходимых протоколов
    - Добавлены comprehensive тесты для всех функций и edge cases
    - Улучшенная обработка ошибок с детальными сообщениями и инструкциями по устранению неполадок
    - Поддержка различных методов обнаружения: переменные окружения, конфигурационные файлы, процессы

- [x] ST-781: Обновить тестовые случаи для использования ProcessRecord::default()
  - Тип: Rust / core / testing / refactoring
  - Примечания: Оптимизация тестовых случаев путем использования ProcessRecord::default() вместо ручной инициализации
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Оценка времени: ~30 минут
  - Критерии готовности:
    - [x] Обновить тесты в classify/rules.rs
    - [x] Обновить тесты в logging/snapshots.rs
    - [x] Обновить тесты в metrics/process.rs
    - [x] Обновить тесты в policy/engine.rs
    - [x] Проверить успешную компиляцию всех измененных модулей
  - Ожидаемые результаты: Более чистый и поддерживаемый тестовый код
  - Результаты:
    - Успешно обновлены все тестовые случаи с использованием ProcessRecord::default()
    - Уменьшено дублирование кода в тестах
    - Сохранена полная функциональность всех тестов
    - Код успешно компилируется без ошибок
    - Улучшена читаемость и поддерживаемость тестового кода

## 2. Бэклог

- [ ] ST-743: Добавить поддержку мониторинга дискового ввода-вывода на уровне процессов
  - Тип: Rust / core / metrics / io
  - Примечания: Расширенный мониторинг операций ввода-вывода для процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (/proc, eBPF, io_uring)
    - [ ] Реализовать сбор метрик дискового ввода-вывода
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более точный мониторинг дисковой активности
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (/proc, eBPF, io_uring)
    - [ ] Реализовать сбор метрик дискового ввода-вывода
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более точный мониторинг дисковой активности

- [ ] ST-744: Улучшить систему автоматического обновления конфигурации
  - Тип: Rust / core / config / auto-update
  - Примечания: Автоматическое обновление конфигурации и паттернов без перезапуска
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Реализовать механизм наблюдения за файлами конфигурации
    - [ ] Добавить горячую перезагрузку паттернов и политик
    - [ ] Реализовать уведомления об изменениях конфигурации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более гибкая система управления конфигурацией

## 3. Недавно сделано (Recently Done)

- [x] ST-781: Обновить тестовые случаи для использования ProcessRecord::default()
  - Тип: Rust / core / testing / refactoring
  - Примечания: Оптимизация тестовых случаев путем использования ProcessRecord::default() вместо ручной инициализации
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Результаты:
    - Успешно обновлены все тестовые случаи с использованием ProcessRecord::default()
    - Уменьшено дублирование кода в тестах
    - Сохранена полная функциональность всех тестов
    - Код успешно компилируется без ошибок
    - Улучшена читаемость и поддерживаемость тестового кода

- [x] ST-741: Улучшить интеграцию с Wayland для мониторинга окон
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение поддержки Wayland для интроспекции окон и приложений
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Результаты:
    - Реализован WaylandIntrospector с поддержкой wlr-foreign-toplevel-management протокола
    - Добавлена функция is_wayland_available() для обнаружения Wayland окружения
    - Реализована функция detect_wayland_compositor() для определения типа композитора
    - Поддержка основных композиторов: Mutter, KWin, Sway, Hyprland, Wayfire, Weston, River
    - Полная интеграция с WindowIntrospector trait для использования в системе классификации
    - Реализована graceful degradation при отсутствии Wayland или необходимых протоколов
    - Добавлены comprehensive тесты для всех функций и edge cases
    - Улучшенная обработка ошибок с детальными сообщениями и инструкциями по устранению неполадок
    - Поддержка различных методов обнаружения: переменные окружения, конфигурационные файлы, процессы

- [x] ST-740: Реализовать расширенный мониторинг энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Добавление мониторинга энергопотребления на уровне процессов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Результаты:
    - Создан новый модуль process_energy.rs с полным API для мониторинга энергопотребления процессов
    - Поддержка нескольких источников данных: /proc/[pid]/power/energy_uj, RAPL, eBPF
    - Реализована структура ProcessEnergyStats для хранения статистики энергопотребления
    - Добавлена поддержка EnergySource для отслеживания источника данных
    - Интегрировано с существующей системой метрик процессов
    - Добавлены comprehensive тесты для нового функционала
    - Реализована синхронная и асинхронная версии API
    - Добавлена поддержка batch обработки для нескольких процессов
    - Интегрировано с ProcessRecord для автоматического сбора метрик энергопотребления
    - Добавлена поддержка сериализации/десериализации для логирования и API
    - Реализована система кэширования и оптимизации производительности
    - Добавлена поддержка различных конфигураций мониторинга (RAPL, eBPF, ProcPower)
    - Полная интеграция с существующей инфраструктурой eBPF
    - Поддержка надежности данных и отслеживания источников
    - Добавлены тесты для всех вариантов использования и edge cases

- [x] ST-776: Добавить поддержку мониторинга температуры и энергопотребления GPU
  - Тип: Rust / core / metrics / gpu
  - Примечания: Расширение мониторинга GPU для включения температуры и энергопотребления
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Добавлены новые поля в ProcessGpuInfo: temperature_c, power_watts
    - Реализованы функции сбора метрик температуры и энергопотребления для NVIDIA, AMD, Intel GPU
    - Добавлены новые API endpoints: /api/gpu/temperature-power, /api/gpu/update-temp-power
    - Интегрировано с существующей системой мониторинга GPU
    - Добавлены comprehensive тесты для новых функций

- [x] ST-775: Улучшить интеграцию health monitoring с системой уведомлений
  - Тип: Rust / core / health / notifications
  - Примечания: Интеграция системы мониторинга здоровья с системой уведомлений
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Добавлены новые API endpoints: /api/health/monitoring, /api/health/diagnostics, /api/health/issues
    - Интегрирована система мониторинга здоровья с API сервером
    - Добавлены comprehensive тесты для новых функций
    - Реализована поддержка уведомлений о проблемах здоровья

- [x] ST-775: Обновить все тестовые случаи с новыми сетевыми полями
  - Тип: Rust / core / testing
  - Примечания: Обновление всех тестовых случаев после добавления сетевых метрик
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~120 минут
  - Результаты:
    - Успешно обновлены все тестовые случаи в модулях actuator.rs, api/server.rs, classify/grouper.rs, classify/ml_classifier.rs, classify/rules.rs
    - Обновлены тесты в logging/snapshots.rs, metrics/app_performance.rs, metrics/process.rs
    - Обновлены тесты в model/features.rs, model/ranker.rs, policy/engine.rs
    - Код успешно компилируется без ошибок
    - Все тесты проходят успешно с новыми сетевыми полями
    - Исправлены все ошибки компиляции, связанные с отсутствующими полями сетевой активности
    - Исправлены неверные ожидания статусов в тестах API обработчиков энергопотребления (process_energy_handler)

- [x] ST-772: Реализовать систему мониторинга здоровья демона
  - Тип: Rust / core / health / monitoring
  - Примечания: Создание комплексной системы мониторинга здоровья демона
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Создан новый модуль health/ с подмодулями diagnostics, monitoring, notifications
    - Реализована основная структура HealthMonitor с поддержкой проверки компонентов
    - Добавлена система диагностики проблем с генерацией отчетов и рекомендаций
    - Реализована служба мониторинга в реальном времени с поддержкой событий
    - Добавлена система уведомлений о проблемах здоровья
    - Интегрировано с API сервером (новые endpoints /api/health/detailed и /api/health/diagnostics)
    - Реализованы реальные проверки здоровья для системных метрик, мониторинга процессов, использования ресурсов и конфигурации
    - Добавлены comprehensive тесты для всех новых функций
    - Создано 4 новых файла: health/mod.rs, health/diagnostics.rs, health/monitoring.rs, health/notifications.rs
    - Обновлены существующие файлы: api/server.rs, lib.rs, Cargo.toml (добавлен uuid)
    - Все тесты проходят успешно

- [x] ST-773: Улучшить систему логирования и анализа производительности
  - Тип: Rust / core / logging / performance
  - Примечания: Оптимизация системы логирования для высокой нагрузки
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Результаты:
    - Добавлена поддержка асинхронного логирования с batch обработкой
    - Реализована система batch’инга для уменьшения накладных расходов на операции ввода-вывода
    - Добавлены счетчики производительности для мониторинга времени выполнения операций
    - Реализована структура LogPerformanceStats для сбора статистики производительности
    - Добавлены методы для включения/отключения асинхронного логирования
    - Реализованы методы для настройки размера batches и получения статистики производительности
    - Добавлены методы flush_batch и flush_batch_with_memory_check для обработки batches
    - Обновлен модуль logging/log_storage.rs с новыми полями и методами
    - Все существующие тесты продолжают работать
    - Добавлены новые тесты для проверки производительности логирования

- [x] ST-774: Реализовать поддержку мониторинга GPU для процессов
  - Тип: Rust / core / metrics / gpu
  - Примечания: Добавление мониторинга использования GPU на уровне процессов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Создан новый модуль metrics/process_gpu.rs для мониторинга GPU на уровне процессов
    - Добавлены новые поля в ProcessRecord для хранения метрик GPU
    - Реализована структура ProcessGpuInfo для хранения информации о GPU, используемом процессом
    - Создан кэш ProcessGpuCache для эффективного хранения метрик GPU
    - Реализован ProcessGpuMonitor с поддержкой различных источников данных (DRM, NVIDIA, AMD, eBPF)
    - Добавлены методы для сбора метрик GPU через различные интерфейсы
    - Реализована интеграция с ProcessRecord через метод update_process_record_with_gpu_metrics
    - Добавлены глобальные экземпляры для удобного доступа
    - Обновлены модули: logging/snapshots.rs (добавлены GPU поля), metrics/mod.rs (добавлен новый модуль)
    - Создано 1 новый файл: metrics/process_gpu.rs
    - Реализация включает упрощённые версии для различных GPU вендоров с комментариями о том, что нужно для полной реализации

- [x] ST-771: Улучшить систему автоматического обнаружения приложений
  - Тип: Rust / core / classify / detection
  - Примечания: Улучшение алгоритмов обнаружения и классификации приложений
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Реализован улучшенный алгоритм обнаружения приложений с расширенными эвристиками
    - Добавлена поддержка обнаружения по аргументам командной строки
    - Добавлена поддержка обнаружения по полному пути исполняемого файла
    - Добавлена поддержка обнаружения по systemd сервисам
    - Добавлена поддержка обнаружения приложений внутри контейнеров и sandbox
    - Реализована логика приоритета: базовое сопоставление имеет приоритет над улучшенными эвристиками
    - Добавлены comprehensive тесты для всех новых функций обнаружения
    - Создан новый файл паттернов containers.yml для обнаружения контейнеров
  - Изменённые файлы:
    - smoothtask-core/src/classify/rules.rs: Добавлены новые методы и улучшенные алгоритмы обнаружения
    - configs/patterns/containers.yml: Новый файл паттернов для контейнеров

- [x] ST-770: Реализовать расширенный мониторинг сетевой активности процессов
  - Тип: Rust / core / metrics / network
  - Примечания: Добавление детального мониторинга сетевых соединений и трафика
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Создан новый модуль process_network.rs с полным API для мониторинга сетевой активности процессов
    - Реализованы функции чтения из /proc/net/tcp и /proc/net/udp
    - Добавлены структуры ProcessNetworkStats и ProcessConnectionStats
    - Интегрировано с существующими структурами ProcessRecord и AppGroupRecord
    - Добавлены comprehensive тесты для нового функционала
    - Реализована поддержка кэширования и бенчмаркинга
  - Изменённые файлы:
    - smoothtask-core/src/metrics/process_network.rs: Новый модуль (34KB)
    - smoothtask-core/src/metrics/mod.rs: Добавлен новый модуль
    - smoothtask-core/src/logging/snapshots.rs: Добавлены сетевые поля
    - smoothtask-core/src/classify/grouper.rs: Обновлена инициализация AppGroupRecord
    - smoothtask-core/src/metrics/process.rs: Обновлена инициализация ProcessRecord

- [x] ST-768: Завершить и протестировать улучшения API обработки ошибок
  - Тип: Rust / core / api / testing
  - Примечания: Завершение рефакторинга обработки ошибок в API сервере
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Реализована унифицированная система обработки ошибок через ApiError
    - Улучшены обработчики процессов и групп приложений с использованием ApiError
    - Улучшена обработка ошибок валидации, не найдено, недоступности сервиса
    - Улучшены сообщения об ошибках и HTTP статусы
    - Все тесты проходят успешно
  - Изменённые файлы:
    - smoothtask-core/src/api/server.rs: Полная рефакторизация обработки ошибок

- [x] ST-767: Оптимизировать производительность критических путей
  - Тип: Performance / Optimization
  - Примечания: Профилирование и оптимизация производительности
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Оптимизирован сбор метрик процессов: уменьшено количество блокировок кэша и улучшена параллельная обработка
    - Добавлена поддержка пакетной обработки в системе логирования для уменьшения накладных расходов
    - Улучшена обработка кэша с уменьшением контенции на блокировках
    - Добавлены оптимизации для уменьшения накладных расходов на логирование
    - Все тесты проходят успешно
  - Изменённые файлы:
    - smoothtask-core/src/metrics/process.rs: Оптимизация параллельной обработки и кэширования
    - smoothtask-core/src/logging/log_storage.rs: Добавлена пакетная обработка записей

- [x] ST-766: Обновить документацию с учетом всех последних изменений
  - Тип: Documentation / API
  - Примечания: Обновление документации для новых функций и изменений API
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Результаты:
    - Обновлена API.md с унифицированной системой обработки ошибок
    - Добавлена документация для AppLogRotator и LogStorage
    - Добавлена документация для метрик энергопотребления процессов с RAPL
    - Добавлена документация для поддержки Wayland композиторов (включая Wayfire)
    - Созданы новые файлы документации: LOGGING_ROTATION.md и WAYLAND_COMPOSITOR_SUPPORT.md
  - Изменённые файлы:
    - docs/API.md: Обновлена система обработки ошибок
    - docs/METRICS.md: Добавлены метрики энергопотребления процессов
    - docs/LOGGING_ROTATION.md: Новая документация для системы логирования
    - docs/WAYLAND_COMPOSITOR_SUPPORT.md: Новая документация для Wayland поддержки

- [x] ST-764: Улучшить поддержку Wayland для различных композиторов
  - Тип: Rust / core / metrics / windows
  - Примечания: Расширение поддержки Wayland композиторов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты:
    - Добавлена поддержка Wayfire композитора в detect_wayland_compositor()
    - Улучшена обработка ошибок с учетом специфики Wayfire
    - Добавлены comprehensive тесты для Wayfire
    - Обновлена документация и примеры
  - Изменённые файлы:
    - smoothtask-core/src/metrics/windows_wayland.rs: Добавлена поддержка Wayfire

- [x] ST-742: Оптимизировать использование памяти в системе логирования
  - Тип: Rust / core / logging / optimization
  - Примечания: Улучшение управления памятью в системе логирования и снапшотов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Результаты:
    - Реализована очистка по памяти с оценкой использования
    - Добавлены функции cleanup_by_memory() и estimate_memory_usage()
    - Реализована memory-aware версия add_entry_with_memory_check()
    - Добавлены comprehensive тесты для нового функционала
    - Интегрировано с системой мониторинга и health status
  - Изменённые файлы:
    - smoothtask-core/src/logging/log_storage.rs: Полная реализация memory optimization

*(Более старые выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

## 4. Блокеры

*(На данный момент нет активных блокеров)*
