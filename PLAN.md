# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [~] ST-696: Реализовать версионирование моделей
  - Тип: ML / Infrastructure
  - Примечания: Добавить поддержку нескольких версий моделей с возможностью отката
  - Приоритет: Высокий
  - Статус: IN PROGRESS (частично завершено)
  - Время выполнения: ~60 минут
  - Ожидаемые результаты: Инфраструктура для управления версиями моделей
  - Критерии готовности:
    - [x] Реализовать структуру ModelVersion с версионированием
    - [x] Добавить механизм хранения и загрузки нескольких версий
    - [x] Реализовать откат к предыдущим версиям
    - [x] Добавить тесты для версионирования
    - [x] Создан модуль `smoothtask-core/src/model/version.rs` с полной поддержкой версионирования
    - [x] Добавлен `ModelVersion` и `ModelVersionManager` для управления версиями
    - [x] Реализован `VersionedONNXRanker` с поддержкой загрузки и переключения версий
    - [x] Обновлен Python тренер для экспорта версионированных моделей
    - [x] Добавлены функции `export_versioned_model` и `create_version_manifest`
    - [x] Полное покрытие тестами для всех компонентов версионирования
  - Результаты:
    - Полная инфраструктура версионирования моделей в Rust и Python
    - Поддержка загрузки, переключения и отката версий
    - Интеграция с ONNXRanker и VersionedONNXRanker
    - Полное покрытие тестами

- [x] ST-697: Улучшить обработку edge cases в данных
  - Тип: Data Quality / ML
  - Примечания: Добавить обработку редких и аномальных случаев в данных
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Ожидаемые результаты: Более robust обработка данных для обучения
  - Критерии готовности:
    - [x] Проанализировать текущие edge cases в данных
    - [x] Добавить обработку missing values и outliers
    - [x] Улучшить валидацию входных данных
    - [x] Добавить функции для обнаружения и обработки выбросов
    - [x] Добавить функции для обработки edge cases в DataFrame
    - [x] Создать функцию load_snapshots_with_edge_case_handling
  - Результаты:
    - Добавлены функции _detect_and_handle_outliers и _validate_data_quality
    - Добавлена функция _add_edge_case_handling_to_dataframe для обработки выбросов и пропущенных значений
    - Добавлена функция load_snapshots_with_edge_case_handling для удобного использования
    - Реализованы методы IQR и Z-score для обнаружения выбросов
    - Добавлена обработка пропущенных значений для числовых, булевых и категориальных данных
    - Выбросы заменяются медианой, пропущенные значения заполняются соответствующими стратегиями

- [x] ST-698: Добавить экспорт метрик производительности в Prometheus
  - Тип: Monitoring / Integration
  - Примечания: Реализовать экспорт MLPerformanceMetrics в Prometheus для мониторинга
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Ожидаемые результаты: Интеграция с системой мониторинга для отслеживания ML производительности
  - Критерии готовности:
    - [x] Добавить Prometheus экспортер для MLPerformanceMetrics
    - [x] Интегрировать MLPerformanceMetrics с экспортером
    - [x] Добавить функции для создания отчетов по производительности
    - [x] Добавить полное покрытие тестами
    - [x] Добавить документацию по мониторингу
    - [x] Добавить примеры использования
  - Результаты:
    - Создан модуль `smoothtask-core/src/metrics/ml_performance.rs`
    - Добавлена функция `ml_metrics_to_prometheus` для экспорта метрик в формат Prometheus
    - Добавлена функция `ml_metrics_map_to_prometheus` для экспорта метрик нескольких моделей
    - Добавлена структура `MLPerformanceReport` для создания структурированных отчетов
    - Добавлена функция `create_ml_performance_reports` для создания отчетов по нескольким моделям
    - Полное покрытие тестами для всех функций
    - Интеграция с существующей системой метрик

## 2. Бэклог

- [ ] ST-699: Добавить поддержку автоматического обновления моделей
  - Тип: ML / Automation
  - Примечания: Реализовать механизм автоматического обновления моделей из репозитория
  - Приоритет: Низкий
  - Ожидаемые результаты: Автоматическое обновление моделей без ручного вмешательства

- [ ] ST-700: Улучшить производительность сбора метрик
  - Тип: Performance / Optimization
  - Примечания: Оптимизировать сбор системных метрик для уменьшения нагрузки
  - Приоритет: Низкий
  - Ожидаемые результаты: Уменьшение нагрузки на систему при сборе метрик

- [ ] ST-701: Добавить поддержку дополнительных метрик GPU
  - Тип: Feature / Monitoring
  - Примечания: Расширить мониторинг GPU метрик для поддержки дополнительных устройств
  - Приоритет: Низкий
  - Ожидаемые результаты: Более полный мониторинг GPU устройств

- [ ] ST-702: Реализовать веб-интерфейс для мониторинга
  - Тип: UI / Monitoring
  - Примечания: Создать простой веб-интерфейс для визуализации метрик и состояния системы
  - Приоритет: Низкий
  - Ожидаемые результаты: Удобный интерфейс для мониторинга системы

## 3. Недавно сделано (Recently Done)

- [x] ST-695: Добавить мониторинг производительности ML модели
  - Тип: Monitoring / ML
  - Примечания: Реализовать метрики для отслеживания качества и производительности ML модели
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Полная система мониторинга ML производительности с метриками времени, уверенности, успешности и категоризации классификаций

- [x] ST-694: Улучшить обработку ошибок в критических модулях
  - Тип: Code Quality / Error Handling
  - Примечания: Добавление более детальных сообщений об ошибках и улучшение graceful degradation
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Результаты: Значительно улучшено качество обработки ошибок, добавлены контекстные сообщения, улучшено graceful degradation и логирование

- [x] ST-693: Добавить комплексную документацию для новых функций
  - Тип: Documentation
  - Примечания: Обновление документации для новых функций, API и изменений в коде
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Полная и актуальная документация по ML workflow с примерами и руководствами

- [x] ST-692: Интегрировать обученную модель в конфигурацию
  - Тип: Integration / Configuration
  - Примечания: Обновить конфигурацию для использования обученной модели
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~15 минут
  - Результаты: Обновлена конфигурация и создана документация для использования ML модели

- [x] ST-691: Обучить модель на реальных данных
  - Тип: ML / Training
  - Примечания: Обучить CatBoostRanker модель на собранных данных
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Обученная модель CatBoostRanker с параметрами YetiRank, depth=6, learning_rate=0.1, iterations=500

- [x] ST-690: Собрать данные в текущей сессии для обучения модели
  - Тип: Data Collection / ML
  - Примечания: Собрать текущие снапшоты системы для создания тренировочного датасета
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Результаты: Создан датасет training_data.sqlite с 15 снапшотами, 150 процессами и 60 группами

*(Более старые выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.