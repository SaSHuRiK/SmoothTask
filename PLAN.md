# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [ ] ST-603: Добавить комплексные интеграционные тесты для нового eBPF функционала
  - Тип: Rust / core / tests
  - Примечания: Тестирование полного цикла сбора метрик, фильтрации и оптимизации
  - Приоритет: Высокий
  - Оценка времени: ~90 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Критерии готовности:
    - ✅ Тесты для полного цикла сбора и обработки eBPF метрик
    - ✅ Тесты для фильтрации и агрегации данных
    - ✅ Тесты для оптимизации памяти
    - ✅ Тесты для мониторинга температуры и энергопотребления

- [ ] ST-604: Улучшить обработку ошибок в модуле eBPF
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Добавление более информативных сообщений об ошибках и graceful degradation
  - Приоритет: Средний
  - Оценка времени: ~60 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Критерии готовности:
    - ✅ Улучшенные сообщения об ошибках для всех eBPF операций
    - ✅ Graceful degradation при недоступности eBPF функционала
    - ✅ Логирование ошибок с контекстом

## 2. Бэклог

- [ ] ST-603: Добавить комплексные интеграционные тесты для нового eBPF функционала
  - Тип: Rust / core / tests
  - Примечания: Тестирование полного цикла сбора метрик, фильтрации и оптимизации
  - Приоритет: Средний
  - Оценка времени: ~90 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Критерии готовности:
    - ✅ Тесты для полного цикла сбора и обработки eBPF метрик
    - ✅ Тесты для фильтрации и агрегации данных
    - ✅ Тесты для оптимизации памяти
    - ✅ Тесты для мониторинга температуры и энергопотребления

- [ ] ST-604: Улучшить обработку ошибок в модуле eBPF
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Добавление более информативных сообщений об ошибках и graceful degradation
  - Приоритет: Средний
  - Оценка времени: ~60 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Критерии готовности:
    - ✅ Улучшенные сообщения об ошибках для всех eBPF операций
    - ✅ Graceful degradation при недоступности eBPF функционала
    - ✅ Логирование ошибок с контекстом

- [ ] ST-605: Добавить документацию для новых eBPF возможностей
  - Тип: Documentation / API
  - Примечания: Создание подробной документации для новых eBPF функций
  - Приоритет: Низкий
  - Оценка времени: ~45 минут
  - Зависимости: ST-601, ST-602
  - Критерии готовности:
    - ✅ Документация для функций оптимизации памяти
    - ✅ Документация для фильтрации и агрегации
    - ✅ Документация для мониторинга температуры
    - ✅ Примеры использования в README

- [x] ST-583: Добавить поддержку мониторинга температуры и энергопотребления через eBPF
  - Тип: Rust / core / metrics / eBPF / Hardware
  - Примечания: Расширение eBPF функциональности для мониторинга температуры CPU/GPU и энергопотребления
  - Приоритет: Средний
  - Оценка времени: ~60 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/gpu_monitor.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats, улучшено отслеживание энергопотребления
    - smoothtask-core/src/ebpf_programs/gpu_monitor_optimized.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats_optimized
    - smoothtask-core/src/ebpf_programs/gpu_monitor_high_perf.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats_high_perf
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены новые функции collect_gpu_compute_units_from_maps, collect_gpu_power_usage_from_maps, collect_gpu_temperature_from_maps; обновлены структуры EbpfMetrics и GpuStat с новыми полями; обновлена функция collect_gpu_metrics_parallel для возврата дополнительных метрик
    - smoothtask-core/tests/ebpf_integration_test.rs: Добавлены тесты test_gpu_temperature_and_power_monitoring и test_gpu_comprehensive_monitoring, обновлен тест test_gpu_monitoring_with_detailed_stats
  - Результаты: Полная реализация мониторинга температуры и энергопотребления GPU через eBPF с поддержкой отслеживания температуры, вычислительных единиц и энергопотребления, добавлены соответствующие тесты

- [x] ST-584: Реализовать расширенную фильтрацию и агрегацию eBPF данных
  - Тип: Rust / core / metrics / eBPF / Processing
  - Примечания: Добавление возможностей фильтрации и агрегации eBPF данных на уровне ядра
  - Приоритет: Средний
  - Оценка времени: ~90 минут
  - Зависимости: ST-581 (GPU мониторинг)
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены структуры EbpfFilterConfig, методы apply_filtering, apply_aggregation, apply_filtering_and_aggregation и другие методы для настройки фильтрации и агрегации
  - Новые функции:
    - EbpfFilterConfig: Конфигурация фильтрации и агрегации данных
    - set_filter_config: Установка конфигурации фильтрации
    - apply_filtering: Применение фильтрации к метрикам
    - apply_aggregation: Применение агрегации к метрикам
    - apply_filtering_and_aggregation: Комбинированное применение фильтрации и агрегации
    - set_pid_filtering: Установка фильтрации по идентификаторам процессов
    - set_syscall_type_filtering: Установка фильтрации по типам системных вызовов
    - set_network_protocol_filtering: Установка фильтрации по сетевым протоколам
    - set_port_range_filtering: Установка фильтрации по диапазону портов
    - set_aggregation_parameters: Установка параметров агрегации
    - set_filtering_thresholds: Установка порогов фильтрации
  - Результаты: Полная реализация расширенной фильтрации и агрегации eBPF данных с поддержкой фильтрации по порогам, типам данных, идентификаторам процессов и агрегации детализированных статистик

- [x] ST-585: Оптимизировать использование памяти в eBPF картах
  - Тип: Rust / core / metrics / eBPF / Performance
  - Примечания: Улучшение управления памятью в eBPF картах для уменьшения memory footprint
  - Приоритет: Низкий
  - Оценка времени: ~45 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены методы optimize_ebpf_memory_usage, optimize_map_memory, analyze_map_usage, clear_map_entries, optimize_program_cache, optimize_detailed_stats, set_max_cached_details, get_max_cached_details
  - Новые функции:
    - optimize_ebpf_memory_usage: Оптимизация использования памяти в eBPF картах
    - optimize_map_memory: Оптимизация памяти для конкретной карты
    - analyze_map_usage: Анализ использования карты
    - clear_map_entries: Очистка всех записей в карте
    - optimize_program_cache: Оптимизация кэша программ
    - optimize_detailed_stats: Оптимизация использования памяти в детализированных статистиках
    - set_max_cached_details: Установка ограничения на количество кэшируемых детализированных статистик
    - get_max_cached_details: Получение текущего ограничения на количество кэшируемых детализированных статистик
  - Результаты: Полная реализация оптимизации памяти в eBPF картах с поддержкой анализа использования карт, очистки неиспользуемых записей, оптимизации кэша программ и ограничения количества детализированных статистик

## 3. Недавно сделано (Recently Done)

- [x] ST-602: Улучшить документацию API для основных модулей
  - Тип: Documentation / API
  - Примечания: Создание подробной документации для основных публичных интерфейсов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Созданные файлы:
    - docs/API_METRICS.md: Подробная документация по Metrics API
    - docs/API_POLICY.md: Подробная документация по Policy API
    - docs/API_CLASSIFY.md: Подробная документация по Classify API
  - Изменённые файлы:
    - README.md: Добавлены примеры использования API
  - Результаты: Полная API документация для основных модулей с примерами кода и лучшими практиками

- [x] ST-601: Оптимизировать использование памяти в eBPF структурах
  - Тип: Rust / core / metrics / eBPF / Performance
  - Примечания: Уменьшение memory footprint для eBPF структур данных
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/cpu_metrics_memory_optimized.c: Новая eBPF программа с оптимизацией памяти для CPU метрик
    - smoothtask-core/src/ebpf_programs/gpu_monitor_memory_optimized.c: Новая eBPF программа с оптимизацией памяти для GPU мониторинга
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены функции оптимизации памяти
  - Результаты: Полная реализация оптимизации памяти в eBPF структурах с поддержкой ограничения детализированных статистик и настройки режима оптимизации памяти

- [x] ST-600: Добавить поддержку мониторинга температуры CPU через eBPF
  - Тип: Rust / core / metrics / eBPF / Hardware
  - Примечания: Расширение eBPF функциональности для мониторинга температуры CPU
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/cpu_temperature.c: Улучшена eBPF программа для чтения реальной температуры CPU из thermal событий, добавлен альтернативный kprobe метод
    - smoothtask-core/src/metrics/ebpf.rs: Добавлен метод get_config() для тестирования
    - smoothtask-core/tests/ebpf_integration_test.rs: Исправлены ошибки компиляции и добавлены условные атрибуты
  - Результаты: Улучшенная eBPF программа для мониторинга температуры CPU с поддержкой реальных данных из thermal событий и kprobe альтернативы

- [x] ST-599: Улучшить обработку ошибок в модуле сбора метрик процессов
  - Тип: Rust / core / metrics / process
  - Примечания: Добавление более информативных сообщений об ошибках и graceful degradation для метрик процессов
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/process.rs: Добавлены детальные логи для обработки процессов, улучшенные сообщения об ошибках, graceful degradation
    - smoothtask-core/tests/process_parallel_test.rs: Добавлены тесты для проверки обработки ошибок
  - Результаты: Улучшенные сообщения об ошибках, более информативное логирование, graceful degradation при отсутствии доступа

- [x] ST-598: Исправить ошибки компиляции в eBPF примерах
  - Тип: Rust / core / examples
  - Примечания: Добавление отсутствующих полей в структуру EbpfConfig в примерах
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Изменённые файлы:
    - smoothtask-core/examples/ebpf_example.rs: Добавлены поля enable_cpu_temperature_monitoring и filter_config
    - smoothtask-core/examples/ebpf_advanced_example.rs: Добавлен импорт EbpfFilterConfig
  - Результаты: Устранены ошибки компиляции в примерах

*(Остальные выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.