# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-595: Улучшить обработку ошибок в модуле сбора метрик системы
  - Тип: Rust / core / metrics / system
  - Примечания: Добавление более информативных сообщений об ошибках и graceful degradation
  - Приоритет: Средний
  - Оценка времени: ~45 минут
  - Зависимости: Текущая реализация system.rs
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Добавлены детальные логи для температурного мониторинга, улучшено логирование при отсутствии сенсоров
  - Результаты: Улучшенные сообщения об ошибках и более информативное логирование для отладки проблем с температурными сенсорами

- [x] ST-596: Добавить более детальные логи для температурного мониторинга
  - Тип: Rust / core / metrics / system
  - Примечания: Улучшение логирования для отладки проблем с температурными сенсорами
  - Приоритет: Средний
  - Оценка времени: ~30 минут
  - Зависимости: Текущая реализация system.rs
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Добавлены детальные логи для температурного мониторинга, улучшено логирование при обнаружении и чтении сенсоров
  - Результаты: Улучшенные сообщения об ошибках и более информативное логирование для отладки проблем с температурными сенсорами
  - Критерии готовности:
    - ✅ Детальные логи о найденных/не найденных сенсорах
    - ✅ Логирование путей и типов сенсоров
    - ✅ Улучшенные сообщения об отсутствии температурных данных
    - ✅ Логирование ошибок чтения и парсинга температурных значений
    - ✅ Информативные сообщения о обнаружении CPU и GPU температур

- [x] ST-597: Оптимизировать использование памяти в основных структурах данных
  - Тип: Rust / core / metrics / optimization
  - Примечания: Уменьшение memory footprint для часто используемых структур
  - Приоритет: Низкий
  - Оценка времени: ~60 минут
  - Зависимости: Текущая реализация
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Оптимизация структур NetworkInterface и DiskDevice с использованием Box<str> вместо String, добавление метода optimize_memory_usage() для SystemMetrics
    - smoothtask-core/benches/memory_optimization_bench.rs: Добавление бенчмарков для измерения улучшений памяти
  - Результаты:
    - Уменьшение memory footprint за счет использования Box<str> вместо String для имен интерфейсов и устройств
    - Добавление метода optimize_memory_usage() для очистки пустых коллекций и оптимизации Optional полей
    - Добавление бенчмарков для измерения производительности и использования памяти
    - Все тесты проходят успешно
  - Критерии готовности:
    - ✅ Анализ текущего использования памяти
    - ✅ Оптимизация структур данных
    - ✅ Бенчмарки до и после оптимизации
    - ✅ Все тесты проходят без регрессий

- [x] ST-597: Оптимизировать использование памяти в основных структурах данных
  - Тип: Rust / core / metrics / optimization
  - Примечания: Уменьшение memory footprint для часто используемых структур
  - Приоритет: Низкий
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Оптимизация структур NetworkInterface и DiskDevice с использованием Box<str> вместо String, добавление метода optimize_memory_usage() для SystemMetrics
    - smoothtask-core/benches/memory_optimization_bench.rs: Добавление бенчмарков для измерения улучшений памяти
  - Результаты: Уменьшение memory footprint и добавление методов оптимизации памяти

- [x] ST-598: Исправить ошибки компиляции в eBPF примерах
  - Тип: Rust / core / examples
  - Примечания: Добавление отсутствующих полей в структуру EbpfConfig в примерах
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Изменённые файлы:
    - smoothtask-core/examples/ebpf_example.rs: Добавлены поля enable_cpu_temperature_monitoring и filter_config
    - smoothtask-core/examples/ebpf_advanced_example.rs: Добавлен импорт EbpfFilterConfig
  - Результаты: Устранены ошибки компиляции в примерах

## 2. Бэклог

- [x] ST-583: Добавить поддержку мониторинга температуры и энергопотребления через eBPF
  - Тип: Rust / core / metrics / eBPF / Hardware
  - Примечания: Расширение eBPF функциональности для мониторинга температуры CPU/GPU и энергопотребления
  - Приоритет: Средний
  - Оценка времени: ~60 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/gpu_monitor.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats, улучшено отслеживание энергопотребления
    - smoothtask-core/src/ebpf_programs/gpu_monitor_optimized.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats_optimized
    - smoothtask-core/src/ebpf_programs/gpu_monitor_high_perf.c: Добавлены поля temperature_celsius и max_temperature_celsius в структуру gpu_stats_high_perf
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены новые функции collect_gpu_compute_units_from_maps, collect_gpu_power_usage_from_maps, collect_gpu_temperature_from_maps; обновлены структуры EbpfMetrics и GpuStat с новыми полями; обновлена функция collect_gpu_metrics_parallel для возврата дополнительных метрик
    - smoothtask-core/tests/ebpf_integration_test.rs: Добавлены тесты test_gpu_temperature_and_power_monitoring и test_gpu_comprehensive_monitoring, обновлен тест test_gpu_monitoring_with_detailed_stats
  - Результаты: Полная реализация мониторинга температуры и энергопотребления GPU через eBPF с поддержкой отслеживания температуры, вычислительных единиц и энергопотребления, добавлены соответствующие тесты

- [x] ST-584: Реализовать расширенную фильтрацию и агрегацию eBPF данных
  - Тип: Rust / core / metrics / eBPF / Processing
  - Примечания: Добавление возможностей фильтрации и агрегации eBPF данных на уровне ядра
  - Приоритет: Средний
  - Оценка времени: ~90 минут
  - Зависимости: ST-581 (GPU мониторинг)
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены структуры EbpfFilterConfig, методы apply_filtering, apply_aggregation, apply_filtering_and_aggregation и другие методы для настройки фильтрации и агрегации
  - Новые функции:
    - EbpfFilterConfig: Конфигурация фильтрации и агрегации данных
    - set_filter_config: Установка конфигурации фильтрации
    - apply_filtering: Применение фильтрации к метрикам
    - apply_aggregation: Применение агрегации к метрикам
    - apply_filtering_and_aggregation: Комбинированное применение фильтрации и агрегации
    - set_pid_filtering: Установка фильтрации по идентификаторам процессов
    - set_syscall_type_filtering: Установка фильтрации по типам системных вызовов
    - set_network_protocol_filtering: Установка фильтрации по сетевым протоколам
    - set_port_range_filtering: Установка фильтрации по диапазону портов
    - set_aggregation_parameters: Установка параметров агрегации
    - set_filtering_thresholds: Установка порогов фильтрации
  - Результаты: Полная реализация расширенной фильтрации и агрегации eBPF данных с поддержкой фильтрации по порогам, типам данных, идентификаторам процессов и агрегации детализированных статистик

- [x] ST-585: Оптимизировать использование памяти в eBPF картах
  - Тип: Rust / core / metrics / eBPF / Performance
  - Примечания: Улучшение управления памятью в eBPF картах для уменьшения memory footprint
  - Приоритет: Низкий
  - Оценка времени: ~45 минут
  - Зависимости: Текущая реализация eBPF модуля
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены методы optimize_ebpf_memory_usage, optimize_map_memory, analyze_map_usage, clear_map_entries, optimize_program_cache, optimize_detailed_stats, set_max_cached_details, get_max_cached_details
  - Новые функции:
    - optimize_ebpf_memory_usage: Оптимизация использования памяти в eBPF картах
    - optimize_map_memory: Оптимизация памяти для конкретной карты
    - analyze_map_usage: Анализ использования карты
    - clear_map_entries: Очистка всех записей в карте
    - optimize_program_cache: Оптимизация кэша программ
    - optimize_detailed_stats: Оптимизация использования памяти в детализированных статистиках
    - set_max_cached_details: Установка ограничения на количество кэшируемых детализированных статистик
    - get_max_cached_details: Получение текущего ограничения на количество кэшируемых детализированных статистик
  - Результаты: Полная реализация оптимизации памяти в eBPF картах с поддержкой анализа использования карт, очистки неиспользуемых записей, оптимизации кэша программ и ограничения количества детализированных статистик

## 3. Недавно сделано (Recently Done)

- [x] ST-598: Исправить ошибки компиляции в eBPF примерах
  - Тип: Rust / core / examples
  - Примечания: Добавление отсутствующих полей в структуру EbpfConfig в примерах
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Изменённые файлы:
    - smoothtask-core/examples/ebpf_example.rs: Добавлены поля enable_cpu_temperature_monitoring и filter_config
    - smoothtask-core/examples/ebpf_advanced_example.rs: Добавлен импорт EbpfFilterConfig
  - Результаты: Устранены ошибки компиляции в примерах

- [x] ST-596: Добавить более детальные логи для температурного мониторинга
  - Тип: Rust / core / metrics / system
  - Примечания: Улучшение логирования для отладки проблем с температурными сенсорами
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/system.rs: Добавлены детальные логи для температурного мониторинга, улучшено логирование при обнаружении и чтении сенсоров
  - Результаты: Улучшенные сообщения об ошибках и более информативное логирование для отладки проблем с температурными сенсорами

- [x] ST-592: Исправить ошибки компиляции в ebpf_mock_test.rs
  - Тип: Rust / core / tests
  - Примечания: Добавление отсутствующих полей в структуру EbpfMetrics в тестах
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Изменённые файлы:
    - smoothtask-core/tests/ebpf_mock_test.rs: Добавлены поля gpu_compute_units, gpu_power_usage, gpu_temperature, cpu_temperature, cpu_max_temperature, cpu_temperature_details
  - Результаты: Устранены ошибки компиляции в тестах

- [x] ST-593: Исправить предупреждения clippy в ebpf.rs
  - Тип: Rust / core / code quality
  - Примечания: Удаление неиспользуемых импортов и исправление предупреждений unused_mut
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~15 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Удалены неиспользуемые импорты Notification и NotificationType, исправлены 2 случая unnecessary mut
  - Результаты: Устранены основные предупреждения clippy

- [x] ST-594: Обновить PLAN.md с текущим статусом
  - Тип: Документация / планирование
  - Примечания: Обновление PLAN.md для отражения выполненных задач
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Изменённые файлы:
    - PLAN.md: Обновлен статус задач
  - Результаты: Актуальное состояние плана задач

*(Остальные выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

- [x] ST-582: Интегрировать eBPF метрики с системой уведомлений
  - Тип: Rust / core / notifications / eBPF
  - Примечания: Добавление уведомлений на основе eBPF метрик и событий
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены структуры EbpfNotificationThresholds, обновлена EbpfConfig, добавлены методы для работы с уведомлениями в EbpfMetricsCollector
  - Новые функции:
    - EbpfNotificationThresholds: Конфигурация порогов для уведомлений
    - check_thresholds_and_notify: Проверка порогов и отправка уведомлений
    - can_send_notification: Проверка возможности отправки уведомлений
    - update_last_notification_time: Обновление времени последнего уведомления
    - send_notification: Отправка уведомлений через менеджер
    - new_with_notifications: Конструктор с менеджером уведомлений
    - set_notification_manager: Установка менеджера уведомлений
    - set_notification_cooldown: Установка интервала между уведомлениями
  - Результаты: Полная интеграция eBPF метрик с системой уведомлений, поддержка пороговых уведомлений для CPU, памяти, GPU, сетевых соединений и других метрик

- [x] ST-581: Добавить поддержку мониторинга GPU через eBPF
  - Тип: Rust / core / metrics / eBPF / GPU
  - Примечания: Расширение eBPF функциональности для мониторинга GPU метрик
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены полные реализации функций collect_gpu_memory_from_maps и collect_gpu_details
    - smoothtask-core/src/ebpf_programs/gpu_monitor.c: Улучшены функции отслеживания активности GPU, памяти, вычислительных единиц и добавлено отслеживание энергопотребления
    - smoothtask-core/src/ebpf_programs/gpu_monitor_optimized.c: Добавлено отслеживание энергопотребления в оптимизированной версии
    - smoothtask-core/src/ebpf_programs/gpu_monitor_high_perf.c: Добавлено отслеживание энергопотребления в высокопроизводительной версии
    - smoothtask-core/tests/ebpf_integration_test.rs: Добавлены тесты test_gpu_monitoring_functionality и test_gpu_monitoring_with_detailed_stats
  - Результаты: Полная реализация мониторинга GPU через eBPF с поддержкой отслеживания использования GPU, памяти, вычислительных единиц и энергопотребления, добавлены соответствующие тесты

- [x] ST-578: Оптимизировать загрузку eBPF программ для уменьшения времени инициализации
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Улучшение производительности загрузки eBPF программ
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены новые функции и структуры для оптимизации
  - Новые функции:
    - load_ebpf_program_from_file_with_timeout: Загрузка с таймаутом
    - load_ebpf_programs_parallel: Параллельная загрузка нескольких программ
    - EbpfProgramCache: Кэш загруженных программ
    - initialize_optimized: Оптимизированная инициализация
    - save_program_and_load_maps: Сохранение программ и загрузка карт
    - get_program_cache_stats: Статистика кэша программ
    - clear_program_cache: Очистка кэша программ
  - Результаты: Значительное улучшение производительности загрузки eBPF программ, поддержка параллельной загрузки, кэширование и мониторинг производительности

- [x] ST-577: Добавить примеры использования eBPF в примерах кода
  - Тип: Documentation / Examples
  - Примечания: Демонстрация различных сценариев использования eBPF функциональности
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/examples/ebpf_example.rs: Базовый пример использования eBPF
    - smoothtask-core/examples/ebpf_advanced_example.rs: Продвинутый пример с многопоточностью
    - smoothtask-core/examples/README.md: Документация примеров
  - Результаты: Два полноценных примера с разными сценариями использования eBPF функциональности

- [x] ST-576: Улучшить документацию API для eBPF модуля
  - Тип: Documentation / API
  - Примечания: Создание подробной документации для интеграции eBPF в другие модули
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Изменённые файлы:
    - docs/EBPF_API_DOCUMENTATION.md: Создан новый документ с полной документацией API
  - Результаты: Полная документация всех публичных интерфейсов, структур и примеров использования eBPF модуля

- [x] ST-575: Добавить поддержку дополнительных eBPF метрик (сетевые соединения, процесс-специфичные метрики)
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Расширение функциональности eBPF для более детального мониторинга
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/network_connections.c: Создана новая eBPF программа для мониторинга сетевых соединений
    - smoothtask-core/src/ebpf_programs/process_monitor.c: Создана новая eBPF программа для мониторинга процесс-специфичных метрик
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены новые структуры ConnectionStat и ProcessStat, обновлена конфигурация EbpfConfig, добавлены новые поля в EbpfMetrics, реализованы методы загрузки и сбора новых метрик
  - Результаты: Добавлена поддержка мониторинга сетевых соединений и процесс-специфичных метрик через eBPF, расширена функциональность существующего eBPF модуля, добавлены соответствующие тесты

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.