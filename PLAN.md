# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-469: Обновить тесты API для использования ApiStateBuilder вместо устаревшего метода
  - Тип: Rust / core / tests
  - Критерии готовности:
    - Заменить вызов ApiState::with_all_and_responsiveness_and_config_and_patterns на ApiStateBuilder
    - Обновить тесты в server.rs для использования нового API
    - Обновить использование в lib.rs для использования нового API
    - Убедиться, что все тесты компилируются и проходят
    - Удалить устаревшие методы после обновления всех тестов
  - Примечания: Устранение предупреждений о deprecated методах
  - Приоритет: Высокий
  - Статус: COMPLETED

- [x] ST-470: Улучшить документацию по API серверу с примерами использования ApiStateBuilder
  - Тип: Documentation
  - Критерии готовности:
    - ✅ Добавить примеры использования ApiStateBuilder в документацию API
    - ✅ Обновить комментарии в коде с примерами использования
    - ✅ Документировать преимущества использования ApiStateBuilder
  - Примечания: Улучшение пользовательского опыта при работе с API
  - Приоритет: Высокий
  - Статус: COMPLETED

## 2. Бэклог

- [x] ST-471: Исправить тест config watcher в run_daemon_test.rs
  - Тип: Rust / core / tests
  - Критерии готовности:
    - ✅ Создать временный конфигурационный файл для ConfigWatcher
    - ✅ Убедиться, что тест проходит без ошибок
    - ✅ Обновить тест для использования реального конфигурационного файла
    - ✅ Исправить проблемы с импортами и владением
    - ✅ Использовать конкретный порт вместо порта 0 для axum
  - Примечания: Исправление ошибки с отсутствующим конфигурационным файлом и проблемы с hanging тестами
  - Приоритет: Высокий
  - Статус: COMPLETED

- [ ] ST-461: Расширение документации по интеграции ML-моделей
  - Тип: Documentation
  - Критерии готовности:
    - Документировать процесс обучения и экспорта моделей
    - Добавить примеры конфигурации для разных сценариев
    - Описать процесс интеграции ONNX моделей
    - Добавить troubleshooting guide
  - Примечания: Улучшение пользовательского опыта при работе с ML-функциональностью
  - Приоритет: Низкий

- [ ] ST-472: Улучшить обработку ошибок в API сервере
  - Тип: Rust / core / api
  - Критерии готовности:
    - Добавить более детальные сообщения об ошибках для всех API endpoints
    - Улучшить обработку edge cases (невалидные PID, пустые ID и т.д.)
    - Добавить логирование ошибок с контекстом
    - Написать дополнительные тесты для ошибок
  - Примечания: Улучшение пользовательского опыта и отладки
  - Приоритет: Средний

- [ ] ST-473: Добавить поддержку JSON Schema для API конфигурации
  - Тип: Documentation / API
  - Критерии готовности:
    - Сгенерировать JSON Schema для конфигурационного файла
    - Добавить примеры валидации конфигурации
    - Интегрировать схему в API документацию
  - Примечания: Улучшение документации и валидации
  - Приоритет: Низкий

- [ ] ST-474: Оптимизация производительности API сервера
  - Тип: Rust / core / api
  - Критерии готовности:
    - Профилировать текущую производительность API
    - Добавить кэширование для часто запрашиваемых данных
    - Оптимизировать сериализацию JSON
    - Добавить метрики производительности
  - Примечания: Улучшение производительности для высоконагруженных сценариев
  - Приоритет: Средний

- [ ] ST-459: Улучшение WaylandIntrospector для полной поддержки композиторов
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Протестировать с различными Wayland композиторами (KWin, Mutter, Sway, Hyprland)
    - Добавить обработку дополнительных протоколов при необходимости
    - Улучшить обработку ошибок и логирование
    - Написать интеграционные тесты для различных сценариев
  - Примечания: Улучшение стабильности и совместимости
  - Приоритет: Средний

## 3. Недавно сделано (Recently Done)

- [x] ST-471: Исправить тест config watcher в run_daemon_test.rs
  - Тип: Rust / core / tests
  - Примечания: Исправлена ошибка с отсутствующим конфигурационным файлом для ConfigWatcher. Добавлено создание временного конфигурационного файла, исправлены проблемы с импортами и владением. Использован конкретный порт 18080 вместо порта 0 для совместимости с axum. Тест теперь компилируется и готов к выполнению.

- [x] ST-470: Улучшить документацию по API серверу с примерами использования ApiStateBuilder
  - Тип: Documentation
  - Примечания: Добавлена полная документация по ApiStateBuilder с примерами использования, сравнением с устаревшими методами и описанием преимуществ. Обновлены комментарии в коде для всех методов builder.

- [x] ST-469: Обновить тесты API для использования ApiStateBuilder вместо устаревшего метода
  - Тип: Rust / core / tests
  - Примечания: Заменены все вызовы устаревшего метода with_all_and_responsiveness_and_config_and_patterns на ApiStateBuilder. Обновлены тесты в server.rs и использование в lib.rs. Удалены устаревшие методы. Все тесты проходят успешно.

- [x] ST-468: Исправить предупреждения о неиспользуемых переменных
  - Тип: Rust / core / cleanup
  - Примечания: Исправлены предупреждения о неиспользуемых переменных в system.rs. Улучшено качество кода.

- [x] ST-467: Исправить ошибки импорта в тестовых файлах
  - Тип: Rust / core / tests
  - Примечания: Исправлены пути импорта config::config -> config::config_struct в тестовых файлах. Все тесты теперь компилируются без ошибок.

- [x] ST-466: Расширение документации по интеграции ML-моделей
  - Тип: Documentation
  - Примечания: Создана полная документация по ONNX интеграции, включая руководство по настройке, примеры конфигураций, troubleshooting guide и обновление существующей документации.

- [x] ST-465: Исправить предупреждения Clippy и улучшить качество кода
  - Тип: Rust / core / cleanup
  - Примечания: Исправлены все предупреждения Clippy, включая collapsible_if, too_many_arguments, derivable_impls, unnecessary_map_or, trim_split_whitespace, default_constructed_unit_structs и module_inception. Улучшено качество кода и соблюдение лучших практик.

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.