# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [x] ST-754: Улучшить систему автоматического обновления конфигурации
  - Тип: Rust / core / config / auto-update
  - Примечания: Автоматическое обновление конфигурации и паттернов без перезапуска
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Реализовать механизм наблюдения за файлами конфигурации
    - [x] Добавить горячую перезагрузку паттернов и политик
    - [x] Реализовать уведомления об изменениях конфигурации
    - [x] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более гибкая система управления конфигурацией
  - Результаты:
    - Реализован PatternWatcher для мониторинга изменений в директории с паттернами
    - Добавлена поддержка автоматического обновления паттерн-базы
    - Интегрирована система уведомлений об изменениях паттернов
    - Добавлены тесты для нового функционала
    - Обновлена документация и примеры конфигурации
  - Изменённые файлы:
    - smoothtask-core/src/classify/pattern_watcher.rs: Полная реализация PatternWatcher
    - smoothtask-core/src/classify/rules.rs: Обновлены функции классификации для работы с Arc<Mutex<PatternDatabase>>
    - smoothtask-core/src/lib.rs: Интеграция PatternWatcher в основной цикл демона

- [x] ST-755: Исправить ошибки компиляции после добавления I/O полей в ProcessRecord и AppGroupRecord
  - Тип: Rust / core / bugfix
  - Примечания: Исправление ошибок компиляции в тестах после добавления новых I/O полей
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Критерии готовности:
    - [x] Исправить ошибки в actuator.rs
    - [x] Исправить ошибки в api/server.rs
    - [x] Исправить ошибки в classify/grouper.rs
    - [x] Исправить ошибки в classify/ml_classifier.rs
    - [x] Исправить ошибки в classify/rules.rs
    - [x] Исправить ошибки в policy/engine.rs
    - [x] Исправить ошибки в model/features.rs
    - [x] Исправить ошибки в metrics/process.rs
    - [x] Исправить ошибки в metrics/app_performance.rs
    - [x] Исправить ошибки в logging/snapshots.rs
  - Ожидаемые результаты: Успешная компиляция всех модулей
  - Результаты:
    - Добавлены недостающие I/O поля (io_read_operations, io_write_operations, io_total_operations, io_last_update_ns, io_data_source) во все экземпляры ProcessRecord и AppGroupRecord
    - Исправлены все ошибки компиляции E0063
    - Успешная компиляция библиотеки smoothtask-core
  - Изменённые файлы:
    - smoothtask-core/src/actuator.rs: Исправлены тестовые данные
    - smoothtask-core/src/api/server.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/grouper.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/rules.rs: Исправлены тестовые данные
    - smoothtask-core/src/policy/engine.rs: Исправлены тестовые данные
    - smoothtask-core/src/model/features.rs: Исправлены тестовые данные
    - smoothtask-core/src/metrics/process.rs: Исправлены тестовые данные
    - smoothtask-core/src/metrics/app_performance.rs: Исправлены тестовые данные
    - smoothtask-core/src/logging/snapshots.rs: Исправлены тестовые данные

## 2. Бэклог

- [ ] ST-740: Реализовать расширенный мониторинг энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Добавление мониторинга энергопотребления на уровне процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (RAPL, eBPF, sysfs)
    - [ ] Реализовать сбор метрик энергопотребления
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Расширенный мониторинг энергопотребления для оптимизации политик

- [ ] ST-741: Улучшить интеграцию с Wayland для мониторинга окон
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение поддержки Wayland для интроспекции окон и приложений
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Исследовать Wayland протоколы для интроспекции
    - [ ] Реализовать поддержку основных композиторов (KWin, Mutter, Sway)
    - [ ] Интегрировать с существующей системой классификации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Полноценная поддержка Wayland для мониторинга окон

- [ ] ST-742: Оптимизировать использование памяти в системе логирования
  - Тип: Rust / core / logging / optimization
  - Примечания: Улучшение управления памятью в системе логирования и снапшотов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~45 минут
  - Критерии готовности:
    - [ ] Проанализировать текущее использование памяти
    - [ ] Реализовать ротацию и очистку старых логов
    - [ ] Добавить лимиты на размер логов
    - [ ] Добавить мониторинг использования памяти
  - Ожидаемые результаты: Более эффективное использование памяти в системе логирования

- [ ] ST-743: Добавить поддержку мониторинга дискового ввода-вывода на уровне процессов
  - Тип: Rust / core / metrics / io
  - Примечания: Расширенный мониторинг операций ввода-вывода для процессов
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~60 минут
  - Критерии готовности:
    - [ ] Исследовать доступные источники данных (/proc, eBPF, io_uring)
    - [ ] Реализовать сбор метрик дискового ввода-вывода
    - [ ] Интегрировать с существующей системой метрик
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более точный мониторинг дисковой активности

- [ ] ST-744: Улучшить систему автоматического обновления конфигурации
  - Тип: Rust / core / config / auto-update
  - Примечания: Автоматическое обновление конфигурации и паттернов без перезапуска
  - Приоритет: Средний
  - Статус: TODO
  - Оценка времени: ~90 минут
  - Критерии готовности:
    - [ ] Реализовать механизм наблюдения за файлами конфигурации
    - [ ] Добавить горячую перезагрузку паттернов и политик
    - [ ] Реализовать уведомления об изменениях конфигурации
    - [ ] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более гибкая система управления конфигурацией

## 3. Недавно сделано (Recently Done)

- [x] ST-755: Исправить ошибки компиляции после добавления I/O полей в ProcessRecord и AppGroupRecord
  - Тип: Rust / core / bugfix
  - Примечания: Исправление ошибок компиляции в тестах после добавления новых I/O полей
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~90 минут
  - Критерии готовности:
    - [x] Исправить ошибки в actuator.rs
    - [x] Исправить ошибки в api/server.rs
    - [x] Исправить ошибки в classify/grouper.rs
    - [x] Исправить ошибки в classify/ml_classifier.rs
    - [x] Исправить ошибки в classify/rules.rs
    - [x] Исправить ошибки в policy/engine.rs
    - [x] Исправить ошибки в model/features.rs
    - [x] Исправить ошибки в metrics/process.rs
    - [x] Исправить ошибки в metrics/app_performance.rs
    - [x] Исправить ошибки в logging/snapshots.rs
  - Ожидаемые результаты: Успешная компиляция всех модулей
  - Результаты:
    - Добавлены недостающие I/O поля (io_read_operations, io_write_operations, io_total_operations, io_last_update_ns, io_data_source) во все экземпляры ProcessRecord и AppGroupRecord
    - Исправлены все ошибки компиляции E0063
    - Успешная компиляция библиотеки smoothtask-core
  - Изменённые файлы:
    - smoothtask-core/src/actuator.rs: Исправлены тестовые данные
    - smoothtask-core/src/api/server.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/grouper.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены тестовые данные
    - smoothtask-core/src/classify/rules.rs: Исправлены тестовые данные
    - smoothtask-core/src/policy/engine.rs: Исправлены тестовые данные
    - smoothtask-core/src/model/features.rs: Исправлены тестовые данные
    - smoothtask-core/src/metrics/process.rs: Исправлены тестовые данные
    - smoothtask-core/src/metrics/app_performance.rs: Исправлены тестовые данные
    - smoothtask-core/src/logging/snapshots.rs: Исправлены тестовые данные

- [x] ST-754: Улучшить систему автоматического обновления конфигурации
  - Тип: Rust / core / config / auto-update
  - Примечания: Автоматическое обновление конфигурации и паттернов без перезапуска
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Реализовать механизм наблюдения за файлами конфигурации
    - [x] Добавить горячую перезагрузку паттернов и политик
    - [x] Реализовать уведомления об изменениях конфигурации
    - [x] Добавить тесты для нового функционала
  - Ожидаемые результаты: Более гибкая система управления конфигурацией
  - Результаты:
    - Реализован PatternWatcher для мониторинга изменений в директории с паттернами
    - Добавлена поддержка автоматического обновления паттерн-базы
    - Интегрирована система уведомлений об изменениях паттернов
    - Добавлены тесты для нового функционала
    - Обновлена документация и примеры конфигурации
  - Изменённые файлы:
    - smoothtask-core/src/classify/pattern_watcher.rs: Полная реализация PatternWatcher
    - smoothtask-core/src/classify/rules.rs: Обновлены функции классификации для работы с Arc<Mutex<PatternDatabase>>
    - smoothtask-core/src/lib.rs: Интеграция PatternWatcher в основной цикл демона

- [x] ST-753: Реализовать расширенный мониторинг дискового ввода-вывода
  - Тип: Rust / core / metrics / io
  - Примечания: Добавление мониторинга операций ввода-вывода для процессов через /proc и eBPF
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Критерии готовности:
    - [x] Добавлены расширенные поля I/O в ProcessRecord и AppGroupRecord
    - [x] Реализована интеграция eBPF disk stats с метриками процессов
    - [x] Добавлены функции enhance_process_with_disk_stats и collect_process_metrics_with_enhanced_io
    - [x] Реализована агрегация I/O метрик в AppGroupRecord
    - [x] Добавлены fallback механизмы для систем без eBPF
    - [x] Добавлены comprehensive тесты для нового функционала
  - Ожидаемые результаты: Более точный мониторинг дисковой активности с детальной статистикой операций
  - Результаты: 
    - ProcessRecord теперь включает io_read_operations, io_write_operations, io_total_operations, io_last_update_ns, io_data_source
    - AppGroupRecord теперь включает агрегированные I/O метрики для групп процессов
    - Добавлены функции для улучшения процессов данными eBPF
    - Реализована интеграция с существующей системой метрик
    - Добавлены тесты для проверки нового функционала
  - Изменённые файлы:
    - smoothtask-core/src/logging/snapshots.rs: Добавлены новые I/O поля в ProcessRecord и AppGroupRecord
    - smoothtask-core/src/metrics/process.rs: Добавлены функции enhance_process_with_disk_stats и collect_process_metrics_with_enhanced_io
    - smoothtask-core/src/classify/grouper.rs: Добавлена агрегация I/O метрик и определение источника данных
    - Тесты: Добавлены comprehensive тесты для нового I/O функционала

- [x] ST-752: Удалить неиспользуемый метод process_events из WaylandIntrospector
  - Тип: Rust / core / metrics / windows / code quality
  - Примечания: Удаление неиспользуемого метода после рефакторинга
  - Приоритет: Низкий
  - Статус: COMPLETED
  - Время выполнения: ~5 минут
  - Результаты: Чистый код без предупреждений компилятора
  - Изменённые файлы:
    - smoothtask-core/src/metrics/windows_wayland.rs: Удалён метод process_events и обновлён тест

- [x] ST-751b: Улучшить обработку ошибок в WaylandIntrospector
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение обработки ошибок и сообщений
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~20 минут
  - Результаты: Более надёжная работа с Wayland
  - Изменённые файлы:
    - smoothtask-core/src/metrics/windows_wayland.rs: Улучшена обработка ошибок в WaylandIntrospector

- [x] ST-751a: Улучшить обнаружение и поддержку Wayland композиторов
  - Тип: Rust / core / metrics / windows
  - Примечания: Улучшение функции detect_wayland_compositor
  - Приоритет: Средний
  - Статус: COMPLETED
  - Время выполнения: ~25 минут
  - Результаты: Более надёжное обнаружение Wayland композиторов
  - Изменённые файлы:
    - smoothtask-core/src/metrics/windows_wayland.rs: Улучшена функция detect_wayland_compositor

- [x] ST-750c: Реализовать базовый сбор метрик энергопотребления процессов
  - Тип: Rust / core / metrics / energy
  - Примечания: Реализация сбора энергопотребления через /proc и RAPL
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~45 минут
  - Результаты: Базовый мониторинг энергопотребления на уровне процессов
  - Изменённые файлы:
    - smoothtask-core/src/metrics/process.rs: Добавлена collect_process_energy_metrics и интеграция
    - smoothtask-core/src/model/ranker.rs: Обновлены тестовые данные с полями энергопотребления

- [x] ST-750b: Завершить обновление тестовых данных с полями энергопотребления
  - Тип: Rust / core / tests
  - Примечания: Завершение обновления тестовых данных во всех модулях
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Все тесты компилируются и проходят с новыми полями энергопотребления
  - Изменённые файлы:
    - Различные модули: Обновлены тестовые данные с полями энергопотребления

- [x] ST-750a: Добавить поля энергопотребления в структуру ProcessRecord
  - Тип: Rust / core / logging
  - Примечания: Добавление полей для хранения метрик энергопотребления процессов
  - Приоритет: Высокий
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Результаты: Структуры данных обновлены с полями энергопотребления
  - Изменённые файлы:
    - smoothtask-core/src/logging/snapshots.rs: Добавлены поля энергопотребления и тесты

*(Более старые выполненные задачи перенесены в архив: docs/history/PLAN_DONE_archive.md)*

## 4. Блокеры

- [x] ST-099: Вернуть зависимость onnxruntime с нужными фичами
  - Тип: Dependency / ML
  - Примечания: Использование ort 2.0.0-rc.10 для ONNX runtime
  - Статус: COMPLETED
  - Время выполнения: ~10 минут
  - Критерии готовности:
    - [x] Проверить доступность необходимых фич в текущей версии ort
    - [x] Обновить зависимости для использования ort с нужными фичами
    - [x] Проверить совместимость с текущим кодом
  - Ожидаемые результаты: Работающая интеграция ONNX runtime
  - Результаты: Текущая версия ort 2.0.0-rc.10 предоставляет все необходимые фичи для работы с ONNX моделями
  - Изменённые файлы:
    - smoothtask-core/Cargo.toml: Использование ort 2.0.0-rc.10 с фичей onnx
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены импорты для совместимости с текущей версией ort
    - smoothtask-core/src/model/onnx_ranker.rs: Использование актуальных импортов ort