# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [ ] ST-531: Провести интеграционное тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / testing
  - Критерии готовности:
    - ✅ Провести тестирование eBPF на реальных системах
    - ✅ Проверить совместимость с различными дистрибутивами Linux
    - ✅ Собрать метрики производительности и стабильности
    - ✅ Документировать результаты и ограничения
  - Примечания: Тестирование eBPF функциональности на реальных системах для обеспечения стабильности
  - Приоритет: Средний

- [ ] ST-532: Оптимизировать производительность основного цикла сбора метрик
  - Тип: Rust / core / metrics / performance
  - Критерии готовности:
    - ✅ Проанализировать текущие узкие места в основном цикле
    - ✅ Оптимизировать параллельный сбор метрик
    - ✅ Добавить кэширование для часто используемых данных
    - ✅ Провести бенчмаркинг до и после оптимизации
  - Примечания: Улучшение общей производительности демона
  - Приоритет: Средний

- [ ] ST-533: Добавить поддержку мониторинга сетевых соединений через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Исследовать возможности мониторинга сетевых соединений через eBPF
    - ✅ Реализовать eBPF программу для отслеживания сетевой активности
    - ✅ Добавить поддержку в EbpfMetricsCollector
    - ✅ Интегрировать с основной системой метрик
    - ✅ Добавить тесты для проверки функциональности
  - Примечания: Расширенный мониторинг сетевой активности для улучшения анализа производительности
  - Приоритет: Низкий

## 2. Бэклог

- [ ] ST-530: Улучшить документацию и тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / documentation
  - Критерии готовности:
    - ✅ Обновить EBPF_SETUP.md с последними изменениями
    - ✅ Добавить примеры использования eBPF в основной документации
    - ✅ Улучшить тестовое покрытие eBPF функциональности
    - ✅ Документировать ограничения и требования к системе
    - ✅ Добавить примеры интеграции с основной системой метрик
  - Примечания: Улучшение документации и тестирования для eBPF функциональности
  - Приоритет: Средний

- [ ] ST-513: Добавить поддержку мониторинга системных вызовов через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Исследовать возможности мониторинга системных вызовов через eBPF
    - ✅ Реализовать eBPF программу для отслеживания системных вызовов
    - ✅ Добавить поддержку в EbpfMetricsCollector
    - ✅ Интегрировать с основной системой метрик
    - ✅ Добавить тесты для проверки функциональности
  - Примечания: Расширенный мониторинг системных вызовов для улучшения анализа производительности
  - Приоритет: Средний

- [ ] ST-514: Оптимизировать производительность eBPF программ
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Проанализировать текущую производительность eBPF программ
    - ✅ Оптимизировать использование карт и структур данных
    - ✅ Уменьшить накладные расходы на сбор метрик
    - ✅ Провести бенчмаркинг до и после оптимизации
  - Примечания: Улучшение производительности eBPF программ для снижения нагрузки на систему
  - Приоритет: Средний

- [ ] ST-515: Провести тестирование eBPF на реальных системах
  - Тип: Rust / core / metrics / eBPF
  - Критерии готовности:
    - ✅ Провести тестирование на различных конфигурациях ядра
    - ✅ Проверить совместимость с различными дистрибутивами Linux
    - ✅ Собрать метрики производительности и стабильности
    - ✅ Документировать результаты и ограничения
  - Примечания: Тестирование eBPF функциональности на реальных системах для обеспечения стабильности
  - Приоритет: Низкий

- [ ] ST-485: Исследовать и добавить поддержку eBPF-метрик
  - Тип: Rust / core / metrics / исследование
  - Критерии готовности:
    - ✅ Исследовать возможности eBPF для сбора метрик
    - ✅ Оценить производительность и совместимость
    - ✅ Добавить базовую поддержку, если применимо
  - Примечания: Потенциальное улучшение для будущих версий
  - Приоритет: Низкий

- [ ] ST-490: Реализовать расширенную систему уведомлений
  - Тип: Rust / core / notifications
  - Критерии готовности:
    - ✅ Исследовать возможности уведомлений через D-Bus
    - ✅ Добавить поддержку уведомлений о изменениях приоритетов
    - ✅ Интегрировать с системой логирования
  - Примечания: Улучшение пользовательского опыта
  - Приоритет: Низкий

## 3. Недавно сделано (Recently Done)

- [x] ST-530: Улучшить документацию и тестирование eBPF функциональности
  - Тип: Rust / core / metrics / eBPF / documentation
  - Примечания: Значительно улучшена документация eBPF с добавлением примеров использования, устранения неполадок, тестирования и будущих улучшений. Добавлены comprehensive тесты для eBPF функциональности.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - docs/EBPF_SETUP.md: Полностью переработана документация с добавлением разделов по архитектуре, расширенной настройке, тестированию и примерам использования
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены 10 новых тестов для улучшения покрытия eBPF функциональности

- [x] ST-513: Добавить поддержку мониторинга системных вызовов через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Реализована расширенная система мониторинга системных вызовов с детализированной статистикой по каждому системному вызову, включая количество вызовов, общее и среднее время выполнения.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/syscall_monitor_advanced.c: Новая eBPF программа с поддержкой детализированного мониторинга
    - smoothtask-core/src/metrics/ebpf.rs: Расширены структуры данных и добавлены новые функции для сбора детализированной статистики
  - Новые возможности:
    - Детализированная статистика по системным вызовам (SyscallStat)
    - Поддержка выбора между базовой и расширенной eBPF программами
    - Расширенные тесты для новой функциональности

- [x] ST-529: Исправить ошибки компиляции в тестах
  - Тип: Rust / core / testing
  - Примечания: Успешно исправлены все ошибки компиляции в тестовых файлах. Код теперь компилируется без ошибок.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/tests/ebpf_integration_test.rs: Исправлены синтаксические ошибки и проблемы с mutability
    - smoothtask-core/tests/ebpf_mock_test.rs: Исправлены проблемы с mutability
    - smoothtask-core/tests/caching_test.rs: Добавлено missing поле ebpf
    - smoothtask-core/tests/api_integration_test.rs: Удален дублирующийся код
    - smoothtask-core/tests/ml_classifier_integration_test.rs: Исправлены проблемы с conditional compilation

- [x] ST-528: Исправить clippy warnings и errors
  - Тип: Rust / core / quality
  - Примечания: Успешно исправлены все clippy warnings и errors. Код теперь компилируется без ошибок и соответствует лучшим практикам Rust.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtask-core/src/utils/cgroups.rs: Исправлены bool_assert_comparison и unused_assignments
    - smoothtask-core/src/classify/rules.rs: Исправлены unused_assignments и unnecessary_closure
    - smoothtask-core/src/classify/ml_classifier.rs: Исправлены identity_op и loop variable issues
    - smoothtask-core/src/metrics/system.rs: Исправлены unused_comparisons и bool_assert_comparison
    - smoothtask-core/src/metrics/ebpf.rs: Исправлены field_reassign_with_default
    - smoothtask-core/src/metrics/gpu.rs: Исправлены field_reassign_with_default и overly_complex_bool_expr
    - smoothtask-core/src/metrics/audio_pipewire.rs: Исправлены assertions_on_constants
    - smoothtask-core/src/logging/rotation.rs: Исправлены map_or simplifications
    - smoothtask-core/src/logging/snapshots.rs: Исправлены map_or simplifications
    - smoothtask-core/src/policy/engine.rs: Добавлены missing imports
    - smoothtask-core/src/api/server.rs: Исправлены empty_line_after_doc_comment и unused_imports
    - smoothtask-core/src/metrics/windows_wayland.rs: Исправлены redundant_field_names

- [x] ST-527: Исправить ошибки компиляции в smoothtaskd и API сервере
  - Тип: Rust / core / build
  - Примечания: Исправлены все ошибки компиляции, связанные с missing imports, private struct imports и синтаксическими ошибками в тестах. Код успешно компилируется.
  - Статус: COMPLETED
  - Время выполнения: ~60 минут
  - Изменённые файлы:
    - smoothtaskd/src/main.rs: Добавлен import Config
    - smoothtaskd/src/systemd.rs: Добавлен import Result
    - smoothtask-core/src/policy/engine.rs: Исправлены missing imports
    - smoothtask-core/src/api/server.rs: Исправлены private struct imports EbpfConfig
    - smoothtask-core/tests/ebpf_mock_test.rs: Исправлена синтаксическая ошибка
    - smoothtask-core/tests/api_integration_test.rs: Исправлена синтаксическая ошибка

- [x] ST-525: Проверить и запустить тесты для текущей функциональности
  - Тип: Rust / core / testing
  - Примечания: Все проблемы компиляции исправлены. Код успешно компилируется и основные тесты работают. Задача завершена.
  - Статус: COMPLETED
  - Время выполнения: ~120 минут

- [x] ST-526: Зафиксировать завершённые задачи в git
  - Тип: Git / commit
  - Примечания: Все завершённые задачи (ST-509, ST-512, ST-516, ST-522, ST-523, ST-525) успешно зафиксированы в git с подробным описанием изменений.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут

- [x] ST-521: Оптимизировать производительность сбора метрик
  - Тип: Rust / core / metrics / performance
  - Примечания: Улучшение общей производительности демона через кэширование и оптимизацию часто вызываемых функций.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/Cargo.toml: Добавлена зависимость lazy_static для глобального кэширования
    - smoothtask-core/src/metrics/system.rs: Добавлено кэширование eBPF коллектора
    - smoothtask-core/src/metrics/ebpf.rs: Добавлены функции кэширования и пакетной обработки

- [x] ST-520: Улучшить систему уведомлений через D-Bus
  - Тип: Rust / core / notifications
  - Примечания: Улучшение пользовательского опыта и интеграции с десктоп-средой через D-Bus уведомления.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/Cargo.toml: Добавлена зависимость zbus для D-Bus поддержки
    - smoothtask-core/src/notifications/mod.rs: Добавлена реализация DBusNotifier

- [x] ST-518: Оптимизировать производительность eBPF программ
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Улучшение производительности eBPF программ для снижения нагрузки на систему.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/cpu_metrics_optimized.c: Оптимизированная версия CPU метрик
    - smoothtask-core/src/ebpf_programs/syscall_monitor_optimized.c: Оптимизированная версия мониторинга системных вызовов
    - smoothtask-core/src/metrics/ebpf.rs: Кэширование и пакетная обработка

- [x] ST-517: Добавить поддержку мониторинга системных вызовов через eBPF
  - Тип: Rust / core / metrics / eBPF
  - Примечания: Базовая реализация мониторинга системных вызовов через eBPF.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут
  - Изменённые файлы:
    - smoothtask-core/src/ebpf_programs/syscall_monitor.c: Базовая eBPF программа
    - smoothtask-core/src/metrics/ebpf.rs: Интеграция с EbpfMetricsCollector

- [x] ST-523: Исправить проблемы компиляции с conditional compilation для ML-фич
  - Тип: Rust / core / build
  - Примечания: Исправлены проблемы компиляции, связанные с conditional compilation для ML-фич (catboost/onnx).
  - Статус: COMPLETED
  - Время выполнения: ~60 минут

- [x] ST-522: Исправить PhantomPinned ошибки в pattern_watcher.rs
  - Тип: Rust / core / classify
  - Примечания: Устранены ошибки PhantomPinned в tokio::select! макросе.
  - Статус: COMPLETED
  - Время выполнения: ~30 минут

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.