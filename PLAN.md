# SmoothTask — план задач

## Легенда статусов

- [ ] TODO       — задача ещё не делалась
- [~] IN PROGRESS — начата, но не завершена
- [x] DONE       — реализовано и покрыто тестами
- [!] BLOCKED    — есть блокер, нужна дополнительная информация

---

## 1. Ближайшие шаги (Next Up)

- [~] ST-459: Улучшение WaylandIntrospector для полной поддержки композиторов
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Протестировать с различными Wayland композиторами (KWin, Mutter, Sway, Hyprland)
    - Добавить обработку дополнительных протоколов при необходимости
    - Улучшить обработку ошибок и логирование
    - Написать интеграционные тесты для различных сценариев
  - Примечания: Улучшение стабильности и совместимости
  - Приоритет: Высокий
  - Подзадачи:
    - [ ] ST-459-1: Добавить поддержку различных Wayland протоколов (KWin, Mutter, Sway, Hyprland)
    - [x] ST-459-2: Улучшить обработку ошибок и логирование в WaylandIntrospector
    - [ ] ST-459-3: Добавить интеграционные тесты для различных сценариев

## 2. Бэклог

- [ ] ST-475: Добавить поддержку мониторинга GPU метрик
  - Тип: Rust / core / metrics
  - Критерии готовности:
    - Реализовать сбор метрик GPU (загрузка, память, температура)
    - Поддержать различные GPU (NVIDIA, AMD, Intel)
    - Добавить интеграцию с существующей системой метрик
    - Написать unit и интеграционные тесты
  - Примечания: Расширение функциональности мониторинга
  - Приоритет: Низкий

- [ ] ST-476: Улучшить обработку ошибок в модуле классификации
  - Тип: Rust / core / classify
  - Критерии готовности:
    - Добавить более детальные сообщения об ошибках
    - Улучшить обработку edge cases
    - Добавить логирование ошибок с контекстом
    - Написать дополнительные тесты
  - Примечания: Улучшение стабильности и отладки
  - Приоритет: Средний

## 3. Недавно сделано (Recently Done)

- [x] ST-459-2: Улучшить обработку ошибок и логирование в WaylandIntrospector
  - Тип: Rust / core / metrics
  - Примечания: Добавлено использование tracing для детального логирования, улучшена обработка ошибок с использованием anyhow::Context, добавлены инструментации для методов, улучшены сообщения об ошибках с контекстной информацией
  - Приоритет: Высокий
  - Статус: COMPLETED

- [x] ST-476: Улучшить обработку ошибок в модуле классификации
  - Тип: Rust / core / classify
  - Примечания: Добавить более детальные сообщения об ошибках, улучшить обработку edge cases, добавить логирование ошибок с контекстом, написать дополнительные тесты
  - Приоритет: Средний
  - Статус: COMPLETED

- [x] ST-475: Добавить поддержку мониторинга GPU метрик
  - Тип: Rust / core / metrics
  - Примечания: Реализовать сбор метрик GPU (загрузка, память, температура), поддержать различные GPU (NVIDIA, AMD, Intel), добавить интеграцию с существующей системой метрик, написать unit и интеграционные тесты
  - Приоритет: Низкий
  - Статус: COMPLETED

- [x] ST-474: Оптимизация производительности API сервера
  - Тип: Rust / core / api
  - Примечания: Реализована система кэширования для часто запрашиваемых данных (процессы, группы приложений). Добавлены метрики производительности API с отслеживанием количества запросов, кэш-хитов, времени обработки. Создан новый endpoint /api/performance для мониторинга производительности. Улучшена обработка JSON-сериализации с добавлением информации о кэше.

- [x] ST-473: Добавить поддержку JSON Schema для API конфигурации
  - Тип: Documentation / API
  - Примечания: Сгенерировать JSON Schema для конфигурационного файла, добавить примеры валидации конфигурации, интегрировать схему в API документацию
  - Статус: COMPLETED

- [x] ST-472: Улучшить обработку ошибок в API сервере
  - Тип: Rust / core / api
  - Примечания: Улучшена валидация входных параметров для endpoint'ов /api/processes/:pid и /api/appgroups/:id. Добавлены проверки на допустимые диапазоны PID, длину и формат ID групп приложений. Улучшены сообщения об ошибках с добавлением детальной информации (поле, значение, ограничения, предложения). Улучшено логирование ошибок с контекстом. Добавлены дополнительные тесты для новых сценариев обработки ошибок.

- [x] ST-471: Исправить тест config watcher в run_daemon_test.rs
  - Тип: Rust / core / tests
  - Примечания: Исправлена ошибка с отсутствующим конфигурационным файлом для ConfigWatcher. Добавлено создание временного конфигурационного файла, исправлены проблемы с импортами и владением. Использован конкретный порт 18080 вместо порта 0 для совместимости с axum. Тест теперь компилируется и готов к выполнению.

- [x] ST-470: Улучшить документацию по API серверу с примерами использования ApiStateBuilder
  - Тип: Documentation
  - Примечания: Добавлена полная документация по ApiStateBuilder с примерами использования, сравнением с устаревшими методами и описанием преимуществ. Обновлены комментарии в коде для всех методов builder.

- [x] ST-469: Обновить тесты API для использования ApiStateBuilder вместо устаревшего метода
  - Тип: Rust / core / tests
  - Примечания: Заменены все вызовы устаревшего метода with_all_and_responsiveness_and_config_and_patterns на ApiStateBuilder. Обновлены тесты в server.rs и использование в lib.rs. Удалены устаревшие методы. Все тесты проходят успешно.

- [x] ST-468: Исправить предупреждения о неиспользуемых переменных
  - Тип: Rust / core / cleanup
  - Примечания: Исправлены предупреждения о неиспользуемых переменных в system.rs. Улучшено качество кода.

- [x] ST-467: Исправить ошибки импорта в тестовых файлах
  - Тип: Rust / core / tests
  - Примечания: Исправлены пути импорта config::config -> config::config_struct в тестовых файлах. Все тесты теперь компилируются без ошибок.

- [x] ST-466: Расширение документации по интеграции ML-моделей
  - Тип: Documentation
  - Примечания: Создана полная документация по ONNX интеграции, включая руководство по настройке, примеры конфигураций, troubleshooting guide и обновление существующей документации.

- [x] ST-465: Исправить предупреждения Clippy и улучшить качество кода
  - Тип: Rust / core / cleanup
  - Примечания: Исправлены все предупреждения Clippy, включая collapsible_if, too_many_arguments, derivable_impls, unnecessary_map_or, trim_split_whitespace, default_constructed_unit_structs и module_inception. Улучшено качество кода и соблюдение лучших практик.

- [x] ST-461: Расширение документации по интеграции ML-моделей
  - Тип: Documentation
  - Примечания: Документация по ONNX интеграции уже существует и выглядит достаточно полной. Нет необходимости в дополнительных изменениях.
  - Статус: COMPLETED

- [x] ST-473: Добавить поддержку JSON Schema для API конфигурации
  - Тип: Documentation / API
  - Примечания: Создан JSON Schema для конфигурации SmoothTask API. Схема включает все необходимые поля с валидацией типов и диапазонов. Добавлена документация по использованию схемы и примеры конфигурационных файлов. Созданы тесты для валидации конфигурации.
  - Статус: COMPLETED

См. архив: docs/history/PLAN_DONE_archive.md

## 4. Блокеры

- [!] ST-099: Вернуть зависимость onnxruntime, когда появится стабильная версия с нужными фичами
  - Нужны: релиз onnxruntime с требуемыми возможностями.